-- kanji=Š¿Žš
-- $Id: v_kojin_shinsei_hist_dat.sql 74435 2020-05-20 07:59:16Z yamashiro $

DROP VIEW V_KOJIN_SHINSEI_HIST_DAT

CREATE VIEW V_KOJIN_SHINSEI_HIST_DAT \
    (KOJIN_NO, \
     SHINSEI_YEAR, \
     SHIKIN_SHOUSAI_DIV, \
     UKE_YEAR, \
     UKE_NO, \
     UKE_EDABAN, \
     ISSUEDATE, \
     SHINSEI_DATE, \
     SHUUGAKU_NO, \
     NENREI, \
     YOYAKU_KIBOU_GK, \
     S_YOYAKU_KIBOU_YM, \
     E_YOYAKU_KIBOU_YM, \
     S_TAIYO_YM, \
     E_TAIYO_YM, \
     SHINSEI_DIV, \
     SETAI_SEQ, \
     SHORI_JYOUKYOU, \
     KEIZOKU_KAISUU, \
     HEIKYUU_SHOUGAKU_STATUS1, \
     HEIKYUU_SHOUGAKU_REMARK1, \
     HEIKYUU_SHOUGAKU_STATUS2, \
     HEIKYUU_SHOUGAKU_GYOUMUCD2, \
     HEIKYUU_SHOUGAKU_REMARK2, \
     HEIKYUU_SHOUGAKU_STATUS3, \
     HEIKYUU_SHOUGAKU_GYOUMUCD3, \
     HEIKYUU_SHOUGAKU_REMARK3, \
     SHITAKU_CANCEL_CHOKU_FLG, \
     SHITAKU_CANCEL_RI_FLG, \
     H_SCHOOL_CD, \
     KATEI, \
     GRADE, \
     ENT_DATE, \
     H_GRAD_YM, \
     SHITAKUKIN_TAIYO_DIV, \
     HEIKYUU_SHITAKU_STATUS1, \
     HEIKYUU_SHITAKU_REMARK1, \
     HEIKYUU_SHITAKU_STATUS2, \
     HEIKYUU_SHITAKU_GYOUMUCD2, \
     HEIKYUU_SHITAKU_REMARK2, \
     HEIKYUU_SHITAKU_STATUS3, \
     HEIKYUU_SHITAKU_GYOUMUCD3, \
     HEIKYUU_SHITAKU_REMARK3, \
     YUUSHI_FAIL, \
     YUUSHI_FAIL_DIV, \
     YUUSHI_FAIL_REMARK, \
     BANK_CD, \
     YUUSHI_COURSE_DIV, \
     RENTAI_CD, \
     SHINKEN1_CD, \
     SHINKEN2_CD, \
     SHUTARU_CD, \
     SHINSEI_KANRYOU_FLG, \
     SHINSEI_CANCEL_FLG, \
     KETTEI_DATE, \
     KETTEI_FLG \
    ) \
AS \
WITH MAX_SHINSEI AS ( \
SELECT \
    KOJIN_NO, \
    SHIKIN_SHOUSAI_DIV, \
    MAX(SHINSEI_YEAR || CAST(ISSUEDATE AS VARCHAR(10))) AS MAX_KEY \
FROM \
    KOJIN_SHINSEI_HIST_DAT \
GROUP BY \
    KOJIN_NO, \
    SHIKIN_SHOUSAI_DIV \
) \
SELECT \
    T1.KOJIN_NO, \
    T1.SHINSEI_YEAR, \
    T1.SHIKIN_SHOUSAI_DIV, \
    T1.UKE_YEAR, \
    T1.UKE_NO, \
    T1.UKE_EDABAN, \
    T1.ISSUEDATE, \
    T1.SHINSEI_DATE, \
    T1.SHUUGAKU_NO, \
    T1.NENREI, \
    T1.YOYAKU_KIBOU_GK, \
    T1.S_YOYAKU_KIBOU_YM, \
    T1.E_YOYAKU_KIBOU_YM, \
    T1.S_TAIYO_YM, \
    T1.E_TAIYO_YM, \
    T1.SHINSEI_DIV, \
    T1.SETAI_SEQ, \
    T1.SHORI_JYOUKYOU, \
    T1.KEIZOKU_KAISUU, \
    T1.HEIKYUU_SHOUGAKU_STATUS1, \
    T1.HEIKYUU_SHOUGAKU_REMARK1, \
    T1.HEIKYUU_SHOUGAKU_STATUS2, \
    T1.HEIKYUU_SHOUGAKU_GYOUMUCD2, \
    T1.HEIKYUU_SHOUGAKU_REMARK2, \
    T1.HEIKYUU_SHOUGAKU_STATUS3, \
    T1.HEIKYUU_SHOUGAKU_GYOUMUCD3, \
    T1.HEIKYUU_SHOUGAKU_REMARK3, \
    T1.SHITAKU_CANCEL_CHOKU_FLG, \
    T1.SHITAKU_CANCEL_RI_FLG, \
    T1.H_SCHOOL_CD, \
    T1.KATEI, \
    T1.GRADE, \
    T1.ENT_DATE, \
    T1.H_GRAD_YM, \
    T1.SHITAKUKIN_TAIYO_DIV, \
    T1.HEIKYUU_SHITAKU_STATUS1, \
    T1.HEIKYUU_SHITAKU_REMARK1, \
    T1.HEIKYUU_SHITAKU_STATUS2, \
    T1.HEIKYUU_SHITAKU_GYOUMUCD2, \
    T1.HEIKYUU_SHITAKU_REMARK2, \
    T1.HEIKYUU_SHITAKU_STATUS3, \
    T1.HEIKYUU_SHITAKU_GYOUMUCD3, \
    T1.HEIKYUU_SHITAKU_REMARK3, \
    T1.YUUSHI_FAIL, \
    T1.YUUSHI_FAIL_DIV, \
    T1.YUUSHI_FAIL_REMARK, \
    T1.BANK_CD, \
    T1.YUUSHI_COURSE_DIV, \
    T1.RENTAI_CD, \
    T1.SHINKEN1_CD, \
    T1.SHINKEN2_CD, \
    T1.SHUTARU_CD, \
    T1.SHINSEI_KANRYOU_FLG, \
    T1.SHINSEI_CANCEL_FLG, \
    T1.KETTEI_DATE, \
    T1.KETTEI_FLG \
FROM \
    KOJIN_SHINSEI_HIST_DAT T1, \
    MAX_SHINSEI T2 \
WHERE \
    T1.KOJIN_NO = T2.KOJIN_NO \
    AND T1.SHIKIN_SHOUSAI_DIV = T2.SHIKIN_SHOUSAI_DIV \
    AND T1.SHINSEI_YEAR || CAST(T1.ISSUEDATE AS VARCHAR(10)) = T2.MAX_KEY
