$Id: readme.txt 76136 2020-08-21 08:33:24Z ooshiro $

2009/11/06  1.KNJF010を元に新規作成

2009/11/11  1.聴力と、尿コンボの幅を指定しない。
            2.「既往症」コンボの幅を指定しない。

2009/11/16  1.「心臓」の「管理区分」は名称マスタ「F130」⇒「F091」に修正

2010/06/01  1.以下の通り修正
            -- [表2][一括更新2]
            --     「尿」欄に「指導区分」コンボを追加
            -- [表3][一括更新3]
            --     「その他疾病及び異常」欄に「指導区分」コンボを追加
            --     「貧血」欄と「事後処置」欄をカット
            --     「備考」の入力文字数を「全角10文字」⇒「全角60文字」に変更

2011/02/25  1.プロパティーのパラメータ「printKenkouSindanIppan」によってレイアウトを変更した。
            2.上記に伴い、心臓・管理区分所見、その他疾病及び異常・所見、事後措置を追加した。

2011/02/28  1.文言追加。「指導区分：」

2011/03/03  1.レイアウト変更（一括更新も含む）

2012/05/01  1.学校医日付（DOC_DATE）の修正
                - MEDEXAM_DET_DAT（YEAR,SCHREGNO指定）にデータがない場合、初期値をログイン日付とする
                
2012/05/11  1.学校医日付（DOC_DATE）の修正の差し戻し（鳥取の仕様のため）
            2.近大は「学校医・日付」が設定されていないとき、nullのまま更新する

2013/03/14  1.プロパティー「printKenkouSindanIppan」が"2"のときのレイアウトを変更した。
            -- （一括更新も含む）
            2.一括更新3に尿・その他検査の桁数チェックを追加した。

2014/02/25  1.プロパティー「printKenkouSindanIppan」に"3"を追加
            2.MEDEXAM_DET_DETAIL_DAT追加に伴う修正

2014/02/25  1.以下のフィールドは"01"で更新する。(printKenkouSindanIppan = 2の場合のみ)
            -- NUTRITIONCD/SPINERIBCD/EYEDISEASECD/R_EAR/L_EAR/NOSEDISEASECD/SKINDISEASECD
            -- TB_REMARKCD/TB_OTHERTESTCD/TB_NAMECD/HEART_MEDEXAM/HEARTDISEASECD/OTHERDISEASECD/TREATCD

2014/03/01  1.事後措置の修正
            2.テキストの入力不可等の処理はprintKenkouSindanIppan = 2の場合行わない

2014/03/20  1.レイアウト修正

2014/03/22  1.尿のその他検査の項目のテキストボックスをコンボボックスに修正（名称マスタF022を表示）　※熊本専用で修正
            2.皮膚疾病の項目にテキストボックスを追加　※熊本専用で修正
            3.文言修正
              - フィルム番号 ⇒ 画像番号
            4.尿の1次、2次の項目にて、何も選択されていない時に更新ボタンを押した時「02 - 」をセットするよう修正　※熊本専用で修正

2014/03/24  1.プロパティー「printKenkouSindanIppan」 = 2の場合のみ、更新時に下記フィールドがNULLの時、名称マスタのNAMESPARE3='1'のNAMECD2の値をセットする
            -- NUTRITIONCD/SPINERIBCD/EYEDISEASECD/R_EAR/L_EAR/NOSEDISEASECD/SKINDISEASECD
            -- TB_REMARKCD/TB_OTHERTESTCD/TB_NAMECD/HEART_MEDEXAM/HEARTDISEASECD/OTHERDISEASECD/TREATCD
            -- ALBUMINURIA1CD/URICSUGAR1CD/URICBLEED1CD/ALBUMINURIA2CD/URICSUGAR2CD/URICBLEED2CD
            2.修正
            
2014/03/25  1.修正した名称マスタ呼び出し時の引数を追加

2014/03/25  1.printKenkouSindanIppan=2（Bパターンの画面）の時、下記の修正
            ★ 視力に’未’の入力可能にした
            ★ 尿その他の検査
            -- MEDEXAM_DET_DETAIL_DATのDET_SEQ’007’のDET_REMARK1に登録し、
            -- V_MEDEXAM_DET_DATのURICOTHERTESTCDを参照する
            【その他】
            ★ printKenkouSindanIppan=3の時、下記の項目のコメントが文字化け
            -- 目の疾病及び異常、耳鼻咽頭疾患 
            ★ 一括更新1の、視力について
            -- printKenkouSindanIppan=0またはnullの時は、数字とマークを表示、以外の時は、マークのみ表示
            ★ readmeの2014/03/01の２番の修正漏れ（一括更新2）
            ★ readmeの2014/03/24の１番の修正漏れ（一括更新1、一括更新2、一括更新3）
            
2014/05/27  1.画面レイアウト修正

2014/08/04  1.ログ取得機能追加

2014/09/03  1.寄生虫卵コンボを追加
            -- 小学は常に表示、中・高はプロパティーを設定
            2.生徒未選択時の一括更新ボタン押下後のエラーメッセージを変更

2014/09/08  1.学校種別をSCHREG_REGD_GDATから取得に変更

2015/03/13  1.printKenkouSindanIppan=2のとき、下記を修正
            -- 尿（蛋白・糖・潜血）の２次が未選択の場合、対象外'98'をセット
            -- メッセージ入力欄を追加
            -- 目の疾病及び異常、耳鼻咽頭疾患にコンボを各3つ追加、既存のコンボは必須入力に変更

2016/04/14  1.高校以外は、結核（間接撮影、所見、その他検査）項目を表示しない。
            2.printKenkouSindanIppan=2以外の時、一括更新２、３にて更新するとＤＢエラーとなる不具合修正
            -- MEDEXAM_DET_DETAIL_DATテーブル項目を
            -- MEDEXAM_DET_DATテーブルに更新しようとしていた。
            -- 当然、存在しない項目のためＤＢエラーとなっていた。

2016/04/15  1.更新時の桁数チェック漏れ。目の疾病及び異常

2016/04/19  1.項目名変更
            -- 脊柱・胸郭 ==> 脊柱・胸郭・四肢 に変更
            2.printKenkouSindanIppan=1　の時、
            -- 尿欄に、その他の検査テキストと指導区分コンボを追加
            -- 学校医欄に、所見コンボとテキストを追加
            -- 内科検診欄をカット

2016/04/20  1.寄生虫卵コンボの表示は、小学もプロパティーuseParasite_Pを設定

2016/05/02  1.プロパティprintKenkouSindanIppan=1　の時、
            -- 結核欄の「病名」を「疾病及び異常」に項目名変更。
            -- 但し、宮城県（名称マスタ「Z010」miyagiken）は「病名」と表示。
            2.プロパティprintKenkouSindanIppan=1　の時、
            -- その他疾病及び異常（尿の下）欄について、
            -- 指導区分のTEXTの前にコンボ追加。
            -- 名称マスタ「F145」を参照。

2016/06/08  1.尿の名称マスタ変更に伴い修正
            -- 蛋白「F020」糖「F019」潜血「F018」
            2.プロパティprintKenkouSindanIppan=1　の時、コンボ４つ追加
            -- 目の疾病及び異常欄に
            -- 　「色覚異常」・・・・・「F051」
            -- 耳鼻咽頭疾患欄に
            -- 　「耳疾患」・・・・・・「F061」
            -- 　「鼻・副鼻腔疾患」・・「F062」
            -- 　「口腔咽頭疾患・異常」「F063」
            ※ v_medexam_det_dat.sql (1.8)
            3.前々回の修正(1番)で、誤記があり訂正
            -- 対象外コードチェックのif文条件を元に戻した

2016/08/30  1.固定文言「生徒」修正
            -- SETTING_DAT参照、なければ固定で「生徒」
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2016/10/05  1.「生徒」名称取得を修正

2017/02/17  1.身長・体重の入力値チェック（標準偏差値算出）
            2.身長別標準体重の表示

2017/03/08  1.以下の修正をした。
            -- 一括更新４の項目に★表示
            -- 尿欄のコンボボックスはnamecd2の表示をしない

2017/04/03  1.栄養状態にテキストを追加(DET_SEQ=009)
            -- v_medexam_det_dat.sql(rev1.9)

2017/04/24  1.プロパティー「printKenkouSindanIppan」が"1"のときの耳鼻咽頭疾患欄を変更
            -- 耳疾患、鼻・副鼻腔疾患、口腔咽頭疾患・異常にテキスト追加
            -- v_medexam_det_dat.sql(rev1.10)
            2.テキストの使用可・不可の処理を修正
            -- コンボの値を数値に変換して2より小さいとき、使用不可

2017/04/25  1.プロパティー「printKenkouSindanIppan」が"1"のとき、皮膚疾患テキスト追加

2017/05/01  1.栄養状態のテキストは値が1以下の場合に使用不可にする

2017/05/09  1.結核の画像番号のサイズをプロパティー「usetb_filmnoFieldSize」参照に変更
            2.聴力に4000Hzテキストボックス追加
            -- プロパティー「useEar4000Hz」が"1"のとき、表示する

2017/05/10  1.一括更新1の聴力に4000Hzテキストボックス追加
            -- プロパティー「useEar4000Hz」が"1"のとき、表示する

2017/05/17  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            --プロパティー追加：use_prg_schoolkind

2017/05/30  1.身長、体重を赤色にする処理をとりあえずカット

2017/06/20  1.文言「db」を「平均dB」に変更

2017/06/29  1.標準体重（名称マスタ「Z010」sapporo）を、赤字表示に変更

2017/07/24  1.MEDEXAM_DET_DETAIL_DATのDET_SEQ='010'のデータを削除しないように修正

2017/09/29  1.更新系処理(一括除く)で、isMedexamDetNoDatWrite = 1の時。MEDEXAM_DET_NO_DATも更新する。

2017/12/11  1.備考テキスト入力を「全角60文字」→「全角100文字」に変更
            -- rep-medexam_det_dat.sql(rev.57437)

2018/02/14  1.Enterキーでの項目移動追加

2018/06/12  1.以下の修正
            --視力テキストをコンボ（F017）に変更
            --宮城は、色覚異常カット
            --事後措置にコンボ（F151）追加
            --結核の疾病及び異常、その他疾病及び異常、事後措置それぞれにテキスト追加
            --学校医所見コンボカット

2018/06/14  1.未検査テーブル（MEDEXAM_DET_NOT_EXAMINED_DAT）にセットされている項目は入力不可にする

2018/06/15  1.NAME_YDATを参照するよう修正

2018/09/07  1.視力の項目に「測定不能」チェックボックスを追加
            2.「測定不能」項目を未検査テーブル（MEDEXAM_DET_NOT_EXAMINED_DAT）に応じて入力不可に設定する処理を追加

2018/11/14  1.文言変更「間接撮影」→「X線撮影」

2019/02/07  1.以下の修正
            --視力左右それぞれに、測定困難追加
            --聴力左右それぞれに、測定困難追加
            --Z010 "fukuiken"の時、座高カット、肥満度、視力・数字入力、貧血を追加
            --身長、体重セットされた時、肥満度自動計算して、栄養状態コンボの値を「F030」を参照して変更する
            --特別支援の時（プロパティ useSpecial_Support_School == "1"）その他疾病及び異常、備考は全角100文字まで

2019/02/18  1.標準体重の表示は小数第３位にする

2019/03/06  1.宮城県の時、座高カット、肥満度を追加

2019/03/15  1.福井県の時、聴力の「平均dB」、「4000Hz」カット

2019/03/19  1.特別支援の時（プロパティ useSpecial_Support_School == "1"）
            --聴力、装用時の項目を追加「平均dB」、「4000Hz」、「状態」

2019/03/19  1.肥満の表示(宮城タイプ)
            -- unHyouji_SITHEIGHT == "1"

2019/09/09  1.左リストは「KNJXEXP_GHR」を参照するよう修正
            --プロパティー「useSpecial_Support_Hrclass」が'1'の場合

2019/09/10  1.左リストに「◎年組（□学年混合）」の括弧内を表示しないよう修正
            --左リスト「KNJXEXP_GHR」の場合

2019/10/17  1.プロパティ「printKenkouSindanIppan」="1"かつ福井県の時、更新時に下記コンボボックスがNULLなら
              それぞれの初期値を設定する。
              　「心臓　臨床医学的検査（心電図）」
              　「尿　その他の検査」
            2.一括更新2、一括更新3でも、更新時に上記となるよう、変更
            --プロパティー「printKenkouSindanIppan」が'1'の場合
            3.近大中学の文字列が一部誤っていたので、修正

2019/12/17  1.プロパティ「unEar_db」=="1"の時、聴覚についてはZ010=="fukuiken"の時と同等の表示となるよう、変更
            --プロパティー「unEar_db」が'1'の場合

2020/01/14  1.学校医の欄に学校医のコンボボックスを追加
            2.一括更新3の学校医の欄に学校医のコンボボックスを追加

2020/01/24  1.福井/佐賀県のみ、肥満度の表示で測定評価平均値データが取得できない場合はBMI判定処理の結果を表示するよう、変更
            2.三重のみ、学校医のコンボボックスをテキストボックスに変更

2020/02/10  1.広工大の時、以下の修正
            --視力は、数値入力にして、文字入力は名称マスタ「F017」を参照する
            --文言変更「平均db」→「1000Hz」

2020/03/23  1.三重の場合、視力コンボではなくテキストに変更
            2.三重の場合、事後措置に表示するコンボをカット
            3.三重の場合、結核の疾病及び異常、その他疾病及び異常、事後措置それぞれのテキストを非表示に変更。
            4.三重の場合、学校医所見のコンボを表示するよう、変更
            -- 1.～4.の修正は、2018/06/12の修正について三重では対応しない状態になるようにする変更)

2020/03/24  1.三重の場合、学校医所見のコンボに表示するデータについて、NAME_YDATを参照するよう修正

2020/04/21  1.駒澤の場合、聴力の項目の入力を、1000Hz/4000Hz毎にコンボで入力する形式に変更
            2.駒澤の場合、心臓の臨床医学的検査(心電図)に心電図Noのテキスト入力を追加
            -- V_MEDEXAM_DET_DATにR_EAR_DB_1000、L_EAR_DB_1000、HEART_GRAPH_NO追加
            3.駒澤の場合、聴力の1000Hz/4000Hzの値、及び心電図Noの入力チェック処理を追加

2020/08/21  1.福井県以外の時は視力の少数点以下のフォーマットを行わないよう修正
            2.「MEDEXAM_DET_DETAIL_DAT」データ削除時、登録する「DET_SEQ」のみ削除するよう修正

2021/02/02  1.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、尿検査の項目に「ＰＨ」を追加(一次、二次共)
              ※小数第1位まで登録
            2.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、一括更新3画面にも「ＰＨ」を追加(一次、二次共)
            -- V_MEDEXAM_DET_DATにURICPH1、URICPH2を追加
            -- KenkouSindan_Ippan_Patternプロパティ追加
            3.リファクタリング

2021/02/03  1.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、「その他疾病及び異常」の項目を
              皮膚疾患の次に移動するよう、変更
            2.リファクタリング
            3.PHのチェック処理を関数化
            4.一括更新3画面のPHの入力桁を修正

2021/02/08  1.リファクタリング
            2.駒澤の場合、「座高」を削除
            3.駒澤の場合、「肥満度」「視力（数字）」「貧血」を追加

2021/03/01  1.福井の場合、視力の表示が正しく表示されない不具合に対応
            2.リファクタリング
            3.福井の場合の判定漏れを修正
            4.駒澤の場合、一括更新1で、聴力がきちんと更新されない不具合に対応
            5.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、聴力を駒澤と同様の処理となるよう、変更

2021/03/05  1.hideSitHeightプロパティが立っている時、座高が非表示となるよう、変更(※熊本でも同様)
            -- hideSitHeightプロパティ追加
            2.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、聴力の箇所で不要な「文字数」を表示しないよう、修正
            3.リファクタリング
            4.htmlの修正箇所が誤っていたので、修正

2021/03/10  1.京都PHPバージョンアップ対応
