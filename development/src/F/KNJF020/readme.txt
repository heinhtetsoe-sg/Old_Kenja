$Id$
/*** KNJF020 健康診断入力（歯・口腔）／賢者版 ***/

2006/05/26 o-naka NO001 「要注意乳歯数」「要観察歯数」を追加
                  NO002 乳歯および永久歯の項目について、数値チェックを追加
2006/07/25 m-yama NO003 年+組表示をクラス名称表示に変更

2008/10/28  1.ソース整理

2009/03/04  1.更新されていなかったので更新
            2.medexam_hdat、medexam_tooth_datにフィールド追加に伴う修正

2009/03/10  1.チェックボックス削除
            2.歯列は、略称の表示も行う。
            3.レイアウト変更
            4.データクリア機能追加
            5.ボタン追加
            6.歯列の合算処理追加

2009/03/11  1.矯正の横にnullの時は’無’、チェックはいったら’有’と表示。
            2.一括更新の矯正の横にもnullの時は’無’、チェックはいったら’有’と表示。

2009/03/25  1.近大本番機で動作しなかったので、修正した。

2009/04/09  1.親知らず（永久歯の○8）は、一括正常入力の対象外
            2.歯式入力に生徒情報を出力

2009/05/20  1.データ削除時にTOOTH_DATEをNULLまたはレコードの削除処理を追加

2009/05/22  1.以下の修正をした。
            -- 一括更新時の日付の更新の不具合を修正、
            -- 一括更新時にチェックボックスがひとつもチェックされていなかったらエラーとする処理追加
            2.歯式からの更新の不具合修正
            3.歯式入力の入力モードの初期値修正

2009/06/18  1.歯式入力時左クリックは、値選択。右クリックは、リスト選択とする。
            2.歯式入力にも、更新後次へボタンを作成

2009/07/16  1.PHP5に対応

2011/03/07  1.歯石沈着、要精検歯数を追加した。
            2.事後処置をコンボに変更した。
            3.「事後処置」→「事後措置」に変更した。
            4.歯式入力に要精検歯を追加した。

2011/05/13  1.乳歯現在数～永久歯要精検歯数で1つでも入力されたら、未入力項目に0をセットする。
            2.歯式入力で1つでも入力されたら、乳歯現在数～永久歯要精検歯数の未入力項目に0をセットする。

2012/06/18  1.その他疾病及び異常テキストを追加した。

2012/07/05  1.歯式入力画面の値選択のラジオボタンの位置修正

2013/03/01  1.咬合コンボを追加した。（プロパティー「useJAWS_JOINTCD3」が"1"のとき表示）

2013/03/04  1.2013/03/01の参照プロパティーを「useMEDEXAM_TOOTH_KUMA」に変更した。
            2.プロパティー「useMEDEXAM_TOOTH_KUMA」が"1"のとき、
            -- 乳歯・要注意乳歯数、永久歯・要観察歯数、永久歯・要精検歯数を使用不可にした。
            -- その他疾病及び異常コンボボックス、所見コンボボックスを非表示にした。
            -- 所見(CO)、所見(GO)、所見(G)を追加した。
            -- 事後処置コンボボックスを非表示にし、事後処置テキストを追加した。
            3.上記の修正に伴い一括更新を修正した。
            4.歯数入力テキストをテキスト内右寄せに変更した。

2013/03/07  1.プロパティー「useMEDEXAM_TOOTH_KUMA」が"1"のとき→プロパティー「printKenkouSindanIppan」が"2"のときに変更した。

2014/02/26  1.プロパティー「printKenkouSindanIppan」に"3"を追加、MEDEXAM_TOOTH_DETAIL_DAT追加に伴う修正

2014/03/24  1.歯式入力の終了ボタンの文言を「戻る」に変更

2014/03/25  1.プロパティー「printKenkouSindanIppan」= '2'の時、レイアウトおよび項目修正（その他疾病及び異常と事後措置）
            2.一括更新時の同様に修正

2014/03/27  1.歯式入力の更新後、親画面にデータを反映する。

2014/08/04  1.ログ取得機能追加

2014/08/26  1.互換なしでも、歯式入力のリスト表示ができるよう修正

2015/03/24  1.歯肉の状態の名称マスタを「F510」から「F513」に変更

2016/04/13  1.健康診断/健康手帳の表示切替ラジオ追加
            2.レイアウト修正/プロパティー追加。(F020_SISIKI_DISP=1or2:表示切替のデフォルト)

2016/04/27  1.歯式入力の修正漏れ

2016/06/14  1.プロパティー「printKenkouSindanIppan」= '2'以外の時、
            -- 「歯列・咬合」と「顎関節」の項目位置を逆にする。
            2.プロパティー「printKenkouSindanIppan」= '2'以外の時、
            -- 「その他疾病及び異常」欄に「口腔の疾病及び異常」コンボとテキストを追加
            ※ v_medexam_tooth_detail_dat.sql (1.2)

2016/06/15  1.永久歯・要精検歯数をカット
            -- 歯式入力のラジオボタン07も削除した。
            2.歯式入力のラジオボタン07を戻し、ラジオボタンは、
            -- 固定ではなく名称マスタ「F550」で制御するように修正

2016/08/30  1.固定文言「生徒」修正
            -- SETTING_DAT参照、なければ固定で「生徒」
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2016/10/06  1.「生徒」名称取得を修正

2017/01/12  1.名称マスタ(F550)に正常-シーラント(08)/正常-サホライド(09)追加に伴う修正。
            -- 金丸さん修正

2017/03/23  1.「顎関節」の項目位置をプロパティー「printKenkouSindanIppan」= '2'以外の時と同様に変更

2017/04/26  1.名称マスタのNAMECD2が"0"の時に起こる不具合を修正（"==" → "==="）

2017/05/16  1.歯列・咬合を別々の入力に変更
            -- プロパティー「printKenkouSindanIppan」= "1"かつ名称マスタ「Z010」が"mieken"のとき

2017/05/17  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            --プロパティー追加：use_prg_schoolkind

2017/05/24  1.歯式入力での更新後前次の生徒へボタンの不具合修正

2017/07/12  1.「学校歯科医・日付」が設定されていないとき、「健康診断実施日付」をセットする
            --近大は「学校歯科医・日付」が設定されていないとき、nullのまま更新する

2017/08/22  1.「Z010」が"musashinohigashi"の時、以下のコンボにはコードを表示しない
            --顎関節、歯列・咬合、歯垢の状態、歯肉の状態

2017/09/11  1.その他疾病及び異常テキストを修正
            -- その他疾病及び異常コンボが"99"またはプロパティー「printKenkouSindanIppan」= "3"のとき使用可

2018/01/10  1.メイン画面に歯式入力を組み込んだ

2018/02/13  1.Enterキーでの項目移動追加

2018/03/19  1.熊本改修（Z010=="kumamoto"）
            --2016年度入学生以降は「歯列」、「咬合」を「歯列・咬合」(F514)に変更
            --「歯肉の状態」コンボで、「02 歯肉異常１」「03 歯肉異常２」を選択時、それぞれ「GO」「G」にチェックを入れる
            --歯式入力で「05 × 要注意乳歯」を選択した場合、「その他疾病及び異常」コンボの値に「06 要注意乳歯」を反映

2018/03/22  1.熊本改修（Z010=="kumamoto"）前回の修正漏れ
            2.熊本改修（Z010=="kumamoto"）条件追加

2018/04/26  1.「Z010」が"musashinohigashi"の時、以下のコンボにはコードを表示せず名称2を表示する
            --顎関節、歯列・咬合、歯垢の状態、歯肉の状態

2018/06/12  1.以下の修正
            --宮城県は、歯石沈着、矯正をカット
            --学校歯科医所見、事後措置にそれぞれテキスト追加

2018/06/13  1.前回の修正漏れ

2018/06/15  1.NAME_YDATを参照するよう修正
            2.学校医所見テキストがその他で開かない不具合を修正

2018/06/26  1.プロパティー「hokenChouhyouProgramid」が"KNJF030D"のとき、三重県と同様とした

2019/03/06  1.宮城県の時、その他疾病及び異常２、その他疾病及び異常３を追加
            --口腔の疾病及び異常コンボをカット

2019/09/09  1.左リストは「KNJXEXP_GHR」を参照するよう修正
            --プロパティー「useSpecial_Support_Hrclass」が'1'の場合

2019/09/10  1.左リストに「◎年組（□学年混合）」の括弧内を表示しないよう修正
            --左リスト「KNJXEXP_GHR」の場合

2019/10/26  1.平成28年度以降入学の場合、「顎関節」「歯垢」「歯肉」コンボの参照する名称マスタのコード切り替えるよう修正

2020/01/14  1.学校医の欄に学校医のコンボボックスを追加
            2.一括更新3の学校医の欄に学校医のコンボボックスを追加

2020/01/24  1.学校医のコンボボックスをテキストボックスに変更

2020/03/23  1.三重では、学校歯科医所見、事後処置にテキストを表示しないよう、変更
            -- 2018/06/12のテキスト追加の修正について、三重では対応しないよう、変更

2020/10/20  1.プロパティー「printKenkouSindanIppan」= '1'の時
            -- 「その他疾病及び異常」と「口腔の疾病及び異常」の欄を分けて表示するよう修正
            2.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_OTHERDISESE_HYOUJI」= '3' の時
            -- 「口腔の疾病及び異常」は3行表示するよう修正
            3.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_DENTISTREMARK_HYOUJI」= '3' の時
            -- 「学校医 所見」は3行表示するよう修正
            4.ソースの自動整形を適用

2020/10/23  1.プロパティー「printKenkouSindanIppan」= '1'の時
            -- 「その他疾病及び異常」と「口腔の疾病及び異常」の欄を分ける表示を戻した
            2.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_OTHERDISESE_HYOUJI2」= '3' の時
            -- 「その他疾病及び異常」は3行表示するよう修正

2020/12/18  1.テキスト入力可能条件を、名称マスタの予備2が'1'で最終取得したNAMECD2と選択した値が同じ時にから名称マスタの予備2が'1'のNAMECD2と選択した値が同じ時に変更
            2.テキスト入力可能条件を、名称マスタの予備2が'1'で最終取得したNAMECD2と選択した値が同じ時にから名称マスタの予備2が'1'のNAMECD2と選択した値が同じ時に変更(Javascript対応)

2021/02/02  1.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、「歯列・咬合」を「歯列」「咬合」の別項目に分けるよう、変更
            2.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、「歯垢の状態」を「歯垢の付着」に変更
            3.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、「顎関節」の表示位置を「咬合」の後になるよう、変更。
            4.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、「歯石沈着」項目は表示しないよう、変更。
            5.一括更新画面も上記1.～4.になるよう、変更
            -- KenkouSindan_Ippan_Patternプロパティ追加
            6.リファクタリング

2021/03/08  1.一般かつKenkouSindan_Ippan_Patternプロパティが1の際、咬合が更新されるよう、修正

2021/03/10  1.京都PHPバージョンアップ対応
