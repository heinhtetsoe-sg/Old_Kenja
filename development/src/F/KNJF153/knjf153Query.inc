<?php

require_once('for_php7.php');

class knjf153Query extends Query {

    //学校名取得
    function getSchoolName($model) {
        $query  = " SELECT ";
        $query .= "     SCHOOL_NAME ";
        $query .= " FROM ";
        $query .= "     CERTIF_SCHOOL_DAT ";
        $query .= " WHERE ";
        $query .= "     YEAR = '".$model->year."' ";
        $query .= " AND CERTIF_KINDCD = '125' ";
        
        return $query;
    }

    //CVS作成用のQUERY
    function selectCsvQuery($model) {
    
        $nextYear = $model->year + 1;

        $query .= " WITH MONTH AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE)      AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     VISIT_REASON1, ";
        $query .= "     COUNT(*)               AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE              , ";
        $query .= "     VISIT_REASON1      ";
        $query .= " ), R_TOTAL AS( ";
        $query .= " SELECT      ";
        $query .= "     TYPE, ";
        $query .= "     VISIT_REASON1, ";
        $query .= "     COUNT(*)               AS CNT ";
        $query .= " FROM ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY  ";
        $query .= "     TYPE              , ";
        $query .= "     VISIT_REASON1      ";
        $query .= " ), TYPE1_MAIN AS( ";
        $query .= " SELECT  ";
        $query .= "     'TYPE1_' || N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1 AS REASON_NAME, ";
        $query .= "     M04.CNT AS M04CNT, ";
        $query .= "     M05.CNT AS M05CNT, ";
        $query .= "     M06.CNT AS M06CNT, ";
        $query .= "     M07.CNT AS M07CNT, ";
        $query .= "     M08.CNT AS M08CNT, ";
        $query .= "     M09.CNT AS M09CNT, ";
        $query .= "     M10.CNT AS M10CNT, ";
        $query .= "     M11.CNT AS M11CNT, ";
        $query .= "     M12.CNT AS M12CNT, ";
        $query .= "     M01.CNT AS M01CNT, ";
        $query .= "     M02.CNT AS M02CNT, ";
        $query .= "     M03.CNT AS M03CNT, ";
        $query .= "     R_TOTAL.CNT AS TOTAL, ";
        $query .= "     1 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN MONTH M04 ON M04.VISIT_REASON1 = N1.NAMECD2 AND M04.TYPE = '1' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN MONTH M05 ON M05.VISIT_REASON1 = N1.NAMECD2 AND M05.TYPE = '1' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN MONTH M06 ON M06.VISIT_REASON1 = N1.NAMECD2 AND M06.TYPE = '1' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN MONTH M07 ON M07.VISIT_REASON1 = N1.NAMECD2 AND M07.TYPE = '1' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN MONTH M08 ON M08.VISIT_REASON1 = N1.NAMECD2 AND M08.TYPE = '1' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN MONTH M09 ON M09.VISIT_REASON1 = N1.NAMECD2 AND M09.TYPE = '1' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN MONTH M10 ON M10.VISIT_REASON1 = N1.NAMECD2 AND M10.TYPE = '1' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN MONTH M11 ON M11.VISIT_REASON1 = N1.NAMECD2 AND M11.TYPE = '1' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN MONTH M12 ON M12.VISIT_REASON1 = N1.NAMECD2 AND M12.TYPE = '1' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN MONTH M01 ON M01.VISIT_REASON1 = N1.NAMECD2 AND M01.TYPE = '1' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN MONTH M02 ON M02.VISIT_REASON1 = N1.NAMECD2 AND M02.TYPE = '1' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN MONTH M03 ON M03.VISIT_REASON1 = N1.NAMECD2 AND M03.TYPE = '1' AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN R_TOTAL ON R_TOTAL.VISIT_REASON1 = N1.NAMECD2 AND R_TOTAL.TYPE = '1' ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F200' ";
        $query .= "     AND N1.NAMECD2 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " ORDER BY ";
        $query .= "     N1.NAMECD2 ";
        $query .= " ), M_TOTAL1 AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE ";
        $query .= " ), M_ALL_TOTAL1 AS( ";
        $query .= " SELECT  ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " GROUP BY ";
        $query .= "     TYPE ";
        $query .= " ), TYPE1_SUB AS ( ";
        $query .= " SELECT ";
        $query .= "     'TYPE1_SUB' AS REASON_CD, ";
        $query .= "     '内科小計'  AS REASON_NAME, ";
        $query .= "     MT04.CNT AS M04CNT, ";
        $query .= "     MT05.CNT AS M05CNT, ";
        $query .= "     MT06.CNT AS M06CNT, ";
        $query .= "     MT07.CNT AS M07CNT, ";
        $query .= "     MT08.CNT AS M08CNT, ";
        $query .= "     MT09.CNT AS M09CNT, ";
        $query .= "     MT10.CNT AS M10CNT, ";
        $query .= "     MT11.CNT AS M11CNT, ";
        $query .= "     MT12.CNT AS M12CNT, ";
        $query .= "     MT01.CNT AS M01CNT, ";
        $query .= "     MT02.CNT AS M02CNT, ";
        $query .= "     MT03.CNT AS M03CNT, ";
        $query .= "     MAT.CNT AS TOTAL, ";
        $query .= "     2 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM M_TOTAL1 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT04 ON T1.TYPE = MT04.TYPE AND MT04.MONTH = 04 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT05 ON T1.TYPE = MT05.TYPE AND MT05.MONTH = 05 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT06 ON T1.TYPE = MT06.TYPE AND MT06.MONTH = 06 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT07 ON T1.TYPE = MT07.TYPE AND MT07.MONTH = 07 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT08 ON T1.TYPE = MT08.TYPE AND MT08.MONTH = 08 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT09 ON T1.TYPE = MT09.TYPE AND MT09.MONTH = 09 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT10 ON T1.TYPE = MT10.TYPE AND MT10.MONTH = 10 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT11 ON T1.TYPE = MT11.TYPE AND MT11.MONTH = 11 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT12 ON T1.TYPE = MT12.TYPE AND MT12.MONTH = 12 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT01 ON T1.TYPE = MT01.TYPE AND MT01.MONTH = 01 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT02 ON T1.TYPE = MT02.TYPE AND MT02.MONTH = 02 ";
        $query .= "     LEFT JOIN M_TOTAL1 MT03 ON T1.TYPE = MT03.TYPE AND MT03.MONTH = 03 ";
        $query .= "     LEFT JOIN M_ALL_TOTAL1 MAT ON T1.TYPE = MAT.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '1' ";
        $query .= " ), TYPE1 AS( ";
        $query .= " SELECT * FROM TYPE1_MAIN ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE1_SUB ";
        $query .= " ), TYPE2_MAIN AS( ";
        $query .= " SELECT  ";
        $query .= "     'TYPE2_' || N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1   AS REASON_NAME, ";
        $query .= "     M04.CNT AS M04CNT, ";
        $query .= "     M05.CNT AS M05CNT, ";
        $query .= "     M06.CNT AS M06CNT, ";
        $query .= "     M07.CNT AS M07CNT, ";
        $query .= "     M08.CNT AS M08CNT, ";
        $query .= "     M09.CNT AS M09CNT, ";
        $query .= "     M10.CNT AS M10CNT, ";
        $query .= "     M11.CNT AS M11CNT, ";
        $query .= "     M12.CNT AS M12CNT, ";
        $query .= "     M01.CNT AS M01CNT, ";
        $query .= "     M02.CNT AS M02CNT, ";
        $query .= "     M03.CNT AS M03CNT, ";
        $query .= "     R_TOTAL.CNT AS TOTAL, ";
        $query .= "     3 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN MONTH M04 ON M04.VISIT_REASON1 = N1.NAMECD2 AND M04.TYPE = '2' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN MONTH M05 ON M05.VISIT_REASON1 = N1.NAMECD2 AND M05.TYPE = '2' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN MONTH M06 ON M06.VISIT_REASON1 = N1.NAMECD2 AND M06.TYPE = '2' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN MONTH M07 ON M07.VISIT_REASON1 = N1.NAMECD2 AND M07.TYPE = '2' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN MONTH M08 ON M08.VISIT_REASON1 = N1.NAMECD2 AND M08.TYPE = '2' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN MONTH M09 ON M09.VISIT_REASON1 = N1.NAMECD2 AND M09.TYPE = '2' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN MONTH M10 ON M10.VISIT_REASON1 = N1.NAMECD2 AND M10.TYPE = '2' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN MONTH M11 ON M11.VISIT_REASON1 = N1.NAMECD2 AND M11.TYPE = '2' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN MONTH M12 ON M12.VISIT_REASON1 = N1.NAMECD2 AND M12.TYPE = '2' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN MONTH M01 ON M01.VISIT_REASON1 = N1.NAMECD2 AND M01.TYPE = '2' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN MONTH M02 ON M02.VISIT_REASON1 = N1.NAMECD2 AND M02.TYPE = '2' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN MONTH M03 ON M03.VISIT_REASON1 = N1.NAMECD2 AND M03.TYPE = '2' AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN R_TOTAL ON R_TOTAL.VISIT_REASON1 = N1.NAMECD2 AND R_TOTAL.TYPE = '2' ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F201' ";
        $query .= "     AND N1.NAMECD2 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " ORDER BY ";
        $query .= "     N1.NAMECD2 ";
        $query .= " ), M_TOTAL2 AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE ";
        $query .= " ), M_ALL_TOTAL2 AS( ";
        $query .= " SELECT  ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03','04','05','06','07','08','99') ";
        $query .= " GROUP BY ";
        $query .= "     TYPE ";
        $query .= " ), TYPE2_SUB AS ( ";
        $query .= " SELECT ";
        $query .= "     'TYPE2_SUB' AS REASON_CD, ";
        $query .= "     '外科小計'  AS REASON_NAME, ";
        $query .= "     MT04.CNT AS M04CNT, ";
        $query .= "     MT05.CNT AS M05CNT, ";
        $query .= "     MT06.CNT AS M06CNT, ";
        $query .= "     MT07.CNT AS M07CNT, ";
        $query .= "     MT08.CNT AS M08CNT, ";
        $query .= "     MT09.CNT AS M09CNT, ";
        $query .= "     MT10.CNT AS M10CNT, ";
        $query .= "     MT11.CNT AS M11CNT, ";
        $query .= "     MT12.CNT AS M12CNT, ";
        $query .= "     MT01.CNT AS M01CNT, ";
        $query .= "     MT02.CNT AS M02CNT, ";
        $query .= "     MT03.CNT AS M03CNT, ";
        $query .= "     MAT.CNT AS TOTAL, ";
        $query .= "     4 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM M_TOTAL2 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT04 ON MT04.TYPE = T1.TYPE AND MT04.MONTH = 04 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT05 ON MT05.TYPE = T1.TYPE AND MT05.MONTH = 05 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT06 ON MT06.TYPE = T1.TYPE AND MT06.MONTH = 06 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT07 ON MT07.TYPE = T1.TYPE AND MT07.MONTH = 07 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT08 ON MT08.TYPE = T1.TYPE AND MT08.MONTH = 08 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT09 ON MT09.TYPE = T1.TYPE AND MT09.MONTH = 09 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT10 ON MT10.TYPE = T1.TYPE AND MT10.MONTH = 10 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT11 ON MT11.TYPE = T1.TYPE AND MT11.MONTH = 11 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT12 ON MT12.TYPE = T1.TYPE AND MT12.MONTH = 12 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT01 ON MT01.TYPE = T1.TYPE AND MT01.MONTH = 01 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT02 ON MT02.TYPE = T1.TYPE AND MT02.MONTH = 02 ";
        $query .= "     LEFT JOIN M_TOTAL2 MT03 ON MT03.TYPE = T1.TYPE AND MT03.MONTH = 03 ";
        $query .= "     LEFT JOIN M_ALL_TOTAL2 MAT ON MAT.TYPE = T1.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '2' ";
        $query .= " ), TYPE2 AS ( ";
        $query .= " SELECT * FROM TYPE2_MAIN ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE2_SUB ";
        $query .= " ), TYPE3_MAIN AS( ";
        $query .= " SELECT  ";
        $query .= "     'TYPE3_' || N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1   AS REASON_NAME, ";
        $query .= "     M04.CNT AS M04CNT, ";
        $query .= "     M05.CNT AS M05CNT, ";
        $query .= "     M06.CNT AS M06CNT, ";
        $query .= "     M07.CNT AS M07CNT, ";
        $query .= "     M08.CNT AS M08CNT, ";
        $query .= "     M09.CNT AS M09CNT, ";
        $query .= "     M10.CNT AS M10CNT, ";
        $query .= "     M11.CNT AS M11CNT, ";
        $query .= "     M12.CNT AS M12CNT, ";
        $query .= "     M01.CNT AS M01CNT, ";
        $query .= "     M02.CNT AS M02CNT, ";
        $query .= "     M03.CNT AS M03CNT, ";
        $query .= "     R_TOTAL.CNT AS TOTAL, ";
        $query .= "     5 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN MONTH M04 ON M04.VISIT_REASON1 = N1.NAMECD2 AND M04.TYPE = '3' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN MONTH M05 ON M05.VISIT_REASON1 = N1.NAMECD2 AND M05.TYPE = '3' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN MONTH M06 ON M06.VISIT_REASON1 = N1.NAMECD2 AND M06.TYPE = '3' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN MONTH M07 ON M07.VISIT_REASON1 = N1.NAMECD2 AND M07.TYPE = '3' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN MONTH M08 ON M08.VISIT_REASON1 = N1.NAMECD2 AND M08.TYPE = '3' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN MONTH M09 ON M09.VISIT_REASON1 = N1.NAMECD2 AND M09.TYPE = '3' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN MONTH M10 ON M10.VISIT_REASON1 = N1.NAMECD2 AND M10.TYPE = '3' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN MONTH M11 ON M11.VISIT_REASON1 = N1.NAMECD2 AND M11.TYPE = '3' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN MONTH M12 ON M12.VISIT_REASON1 = N1.NAMECD2 AND M12.TYPE = '3' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN MONTH M01 ON M01.VISIT_REASON1 = N1.NAMECD2 AND M01.TYPE = '3' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN MONTH M02 ON M02.VISIT_REASON1 = N1.NAMECD2 AND M02.TYPE = '3' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN MONTH M03 ON M03.VISIT_REASON1 = N1.NAMECD2 AND M03.TYPE = '3' AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN R_TOTAL ON R_TOTAL.VISIT_REASON1 = N1.NAMECD2 AND R_TOTAL.TYPE = '3' ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F203' ";
        $query .= "     AND N1.NAMECD2 IN ('01','02','03') ";
        $query .= " ORDER BY ";
        $query .= "     N1.NAMECD2 ";
        $query .= " ), M_TOTAL3 AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03') ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE ";
        $query .= " ), M_ALL_TOTAL3 AS( ";
        $query .= " SELECT  ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND VISIT_REASON1 IN ('01','02','03') ";
        $query .= " GROUP BY ";
        $query .= "     TYPE ";
        $query .= " ), TYPE3_SUB AS ( ";
        $query .= " SELECT ";
        $query .= "     'TYPE3_SUB'  AS REASON_CD, ";
        $query .= "     'その他小計' AS REASON_NAME, ";
        $query .= "     MT04.CNT AS M04CNT, ";
        $query .= "     MT05.CNT AS M05CNT, ";
        $query .= "     MT06.CNT AS M06CNT, ";
        $query .= "     MT07.CNT AS M07CNT, ";
        $query .= "     MT08.CNT AS M08CNT, ";
        $query .= "     MT09.CNT AS M09CNT, ";
        $query .= "     MT10.CNT AS M10CNT, ";
        $query .= "     MT11.CNT AS M11CNT, ";
        $query .= "     MT12.CNT AS M12CNT, ";
        $query .= "     MT01.CNT AS M01CNT, ";
        $query .= "     MT02.CNT AS M02CNT, ";
        $query .= "     MT03.CNT AS M03CNT, ";
        $query .= "     MAT.CNT AS TOTAL, ";
        $query .= "     6 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM M_TOTAL3 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT04 ON MT04.TYPE = T1.TYPE AND MT04.MONTH = 04 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT05 ON MT05.TYPE = T1.TYPE AND MT05.MONTH = 05 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT06 ON MT06.TYPE = T1.TYPE AND MT06.MONTH = 06 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT07 ON MT07.TYPE = T1.TYPE AND MT07.MONTH = 07 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT08 ON MT08.TYPE = T1.TYPE AND MT08.MONTH = 08 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT09 ON MT09.TYPE = T1.TYPE AND MT09.MONTH = 09 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT10 ON MT10.TYPE = T1.TYPE AND MT10.MONTH = 10 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT11 ON MT11.TYPE = T1.TYPE AND MT11.MONTH = 11 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT12 ON MT12.TYPE = T1.TYPE AND MT12.MONTH = 12 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT01 ON MT01.TYPE = T1.TYPE AND MT01.MONTH = 01 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT02 ON MT02.TYPE = T1.TYPE AND MT02.MONTH = 02 ";
        $query .= "     LEFT JOIN M_TOTAL3 MT03 ON MT03.TYPE = T1.TYPE AND MT03.MONTH = 03 ";
        $query .= "     LEFT JOIN M_ALL_TOTAL3 MAT ON MAT.TYPE = T1.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '3' ";
        $query .= " ), TYPE3 AS ( ";
        $query .= " SELECT * FROM TYPE3_MAIN ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE3_SUB ";
        $query .= " ), M_TOTAL5 AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE ";
        $query .= " ), M_ALL_TOTAL5 AS( ";
        $query .= " SELECT  ";
        $query .= "     TYPE, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY ";
        $query .= "     TYPE ";
        $query .= " ), TYPE5 AS ( ";
        $query .= " SELECT ";
        $query .= "     'R100'     AS REASON_CD, ";
        $query .= "     '相談活動' AS REASON_NAME, ";
        $query .= "     MT04.CNT AS M04CNT, ";
        $query .= "     MT05.CNT AS M05CNT, ";
        $query .= "     MT06.CNT AS M06CNT, ";
        $query .= "     MT07.CNT AS M07CNT, ";
        $query .= "     MT08.CNT AS M08CNT, ";
        $query .= "     MT09.CNT AS M09CNT, ";
        $query .= "     MT10.CNT AS M10CNT, ";
        $query .= "     MT11.CNT AS M11CNT, ";
        $query .= "     MT12.CNT AS M12CNT, ";
        $query .= "     MT01.CNT AS M01CNT, ";
        $query .= "     MT02.CNT AS M02CNT, ";
        $query .= "     MT03.CNT AS M03CNT, ";
        $query .= "     MAT.CNT  AS TOTAL, ";
        $query .= "     7 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM M_TOTAL5 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT04 ON T1.TYPE = MT04.TYPE AND MT04.MONTH = 04 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT05 ON T1.TYPE = MT05.TYPE AND MT05.MONTH = 05 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT06 ON T1.TYPE = MT06.TYPE AND MT06.MONTH = 06 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT07 ON T1.TYPE = MT07.TYPE AND MT07.MONTH = 07 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT08 ON T1.TYPE = MT08.TYPE AND MT08.MONTH = 08 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT09 ON T1.TYPE = MT09.TYPE AND MT09.MONTH = 09 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT10 ON T1.TYPE = MT10.TYPE AND MT10.MONTH = 10 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT11 ON T1.TYPE = MT11.TYPE AND MT11.MONTH = 11 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT12 ON T1.TYPE = MT12.TYPE AND MT12.MONTH = 12 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT01 ON T1.TYPE = MT01.TYPE AND MT01.MONTH = 01 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT02 ON T1.TYPE = MT02.TYPE AND MT02.MONTH = 02 ";
        $query .= "     LEFT JOIN M_TOTAL5 MT03 ON T1.TYPE = MT03.TYPE AND MT03.MONTH = 03 ";
        $query .= "     LEFT JOIN M_ALL_TOTAL5 MAT ON T1.TYPE = MAT.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '5' ";
        $query .= " ), TYPE3_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1   AS REASON_NAME, ";
        $query .= "     M04.CNT AS M04CNT, ";
        $query .= "     M05.CNT AS M05CNT, ";
        $query .= "     M06.CNT AS M06CNT, ";
        $query .= "     M07.CNT AS M07CNT, ";
        $query .= "     M08.CNT AS M08CNT, ";
        $query .= "     M09.CNT AS M09CNT, ";
        $query .= "     M10.CNT AS M10CNT, ";
        $query .= "     M11.CNT AS M11CNT, ";
        $query .= "     M12.CNT AS M12CNT, ";
        $query .= "     M01.CNT AS M01CNT, ";
        $query .= "     M02.CNT AS M02CNT, ";
        $query .= "     M03.CNT AS M03CNT, ";
        $query .= "     R_TOTAL.CNT AS TOTAL, ";
        $query .= "     8 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN MONTH M04 ON M04.VISIT_REASON1 = N1.NAMECD2 AND M04.TYPE = '3' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN MONTH M05 ON M05.VISIT_REASON1 = N1.NAMECD2 AND M05.TYPE = '3' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN MONTH M06 ON M06.VISIT_REASON1 = N1.NAMECD2 AND M06.TYPE = '3' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN MONTH M07 ON M07.VISIT_REASON1 = N1.NAMECD2 AND M07.TYPE = '3' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN MONTH M08 ON M08.VISIT_REASON1 = N1.NAMECD2 AND M08.TYPE = '3' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN MONTH M09 ON M09.VISIT_REASON1 = N1.NAMECD2 AND M09.TYPE = '3' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN MONTH M10 ON M10.VISIT_REASON1 = N1.NAMECD2 AND M10.TYPE = '3' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN MONTH M11 ON M11.VISIT_REASON1 = N1.NAMECD2 AND M11.TYPE = '3' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN MONTH M12 ON M12.VISIT_REASON1 = N1.NAMECD2 AND M12.TYPE = '3' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN MONTH M01 ON M01.VISIT_REASON1 = N1.NAMECD2 AND M01.TYPE = '3' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN MONTH M02 ON M02.VISIT_REASON1 = N1.NAMECD2 AND M02.TYPE = '3' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN MONTH M03 ON M03.VISIT_REASON1 = N1.NAMECD2 AND M03.TYPE = '3' AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN R_TOTAL ON R_TOTAL.VISIT_REASON1 = N1.NAMECD2 AND R_TOTAL.TYPE = '3' ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F203' ";
        $query .= "     AND N1.NAMECD2 IN ('04') ";
        $query .= " ORDER BY ";
        $query .= "     N1.NAMECD2 ";
        $query .= " ), TOTAL AS ( ";
        $query .= " SELECT  ";
        $query .= "     'R101'   AS REASON_CD, ";
        $query .= "     '総合計' AS REASON_NAME, ";
        $query .= "     SUM(T1.M04CNT) AS M04CNT, ";
        $query .= "     SUM(T1.M05CNT) AS M05CNT, ";
        $query .= "     SUM(T1.M06CNT) AS M06CNT, ";
        $query .= "     SUM(T1.M07CNT) AS M07CNT, ";
        $query .= "     SUM(T1.M08CNT) AS M08CNT, ";
        $query .= "     SUM(T1.M09CNT) AS M09CNT, ";
        $query .= "     SUM(T1.M10CNT) AS M10CNT, ";
        $query .= "     SUM(T1.M11CNT) AS M11CNT, ";
        $query .= "     SUM(T1.M12CNT) AS M12CNT, ";
        $query .= "     SUM(T1.M01CNT) AS M01CNT, ";
        $query .= "     SUM(T1.M02CNT) AS M02CNT, ";
        $query .= "     SUM(T1.M03CNT) AS M03CNT, ";
        $query .= "     SUM(TOTAL) AS TOTAL, ";
        $query .= "     9 AS ROW ";
        $query .= " FROM  ";
        $query .= "     ( ";
        $query .= "     SELECT * FROM TYPE1_SUB ";
        $query .= "     UNION ";
        $query .= "     SELECT * FROM TYPE2_SUB ";
        $query .= "     UNION ";
        $query .= "     SELECT * FROM TYPE3_SUB ";
        $query .= "     UNION ";
        $query .= "     SELECT * FROM TYPE5 ";
        $query .= "     UNION ";
        $query .= "     SELECT * FROM TYPE3_2 ";
        $query .= "     ) AS T1 ";
        $query .= " ), RESULT_REST_TOTAL AS( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     COUNT(VISIT_DATE) AS CNT, ";
        $query .= "     'X' AS JOINCD ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     RESULT_REST = '1' ";
        $query .= "     AND VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     RESULT_REST ";
        $query .= " ), RESULT_REST_ALL_TOTAL AS( ";
        $query .= " SELECT  ";
        $query .= "     COUNT(VISIT_DATE) AS CNT, ";
        $query .= "     'X' AS JOINCD ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     RESULT_REST = '1' ";
        $query .= "     AND VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= " GROUP BY ";
        $query .= "     RESULT_REST ";
        $query .= " ), RRT AS ( ";
        $query .= " SELECT ";
        $query .= "     'R102'     AS REASON_CD, ";
        $query .= "     '休養者数' AS REASON_NAME, ";
        $query .= "     RRT04.CNT AS M04CNT, ";
        $query .= "     RRT05.CNT AS M05CNT, ";
        $query .= "     RRT06.CNT AS M06CNT, ";
        $query .= "     RRT07.CNT AS M07CNT, ";
        $query .= "     RRT08.CNT AS M08CNT, ";
        $query .= "     RRT09.CNT AS M09CNT, ";
        $query .= "     RRT10.CNT AS M10CNT, ";
        $query .= "     RRT11.CNT AS M11CNT, ";
        $query .= "     RRT12.CNT AS M12CNT, ";
        $query .= "     RRT01.CNT AS M01CNT, ";
        $query .= "     RRT02.CNT AS M02CNT, ";
        $query .= "     RRT03.CNT AS M03CNT, ";
        $query .= "     RRAT.CNT  AS TOTAL, ";
        $query .= "     10 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT JOINCD FROM RESULT_REST_TOTAL GROUP BY JOINCD) T1 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT04 ON RRT04.JOINCD = T1.JOINCD AND RRT04.MONTH = 04 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT05 ON RRT05.JOINCD = T1.JOINCD AND RRT05.MONTH = 05 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT06 ON RRT06.JOINCD = T1.JOINCD AND RRT06.MONTH = 06 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT07 ON RRT07.JOINCD = T1.JOINCD AND RRT07.MONTH = 07 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT08 ON RRT08.JOINCD = T1.JOINCD AND RRT08.MONTH = 08 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT09 ON RRT09.JOINCD = T1.JOINCD AND RRT09.MONTH = 09 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT10 ON RRT10.JOINCD = T1.JOINCD AND RRT10.MONTH = 10 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT11 ON RRT11.JOINCD = T1.JOINCD AND RRT11.MONTH = 11 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT12 ON RRT12.JOINCD = T1.JOINCD AND RRT12.MONTH = 12 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT01 ON RRT01.JOINCD = T1.JOINCD AND RRT01.MONTH = 01 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT02 ON RRT02.JOINCD = T1.JOINCD AND RRT02.MONTH = 02 ";
        $query .= "     LEFT JOIN RESULT_REST_TOTAL RRT03 ON RRT03.JOINCD = T1.JOINCD AND RRT03.MONTH = 03 ";
        $query .= "     LEFT JOIN RESULT_REST_ALL_TOTAL RRAT ON RRAT.JOINCD = T1.JOINCD ";
        $query .= " ), REGD AS ( ";
        $query .= " SELECT DISTINCT ";
        $query .= "     T1.YEAR, ";
        $query .= "     T1.SCHREGNO, ";
        $query .= "     T2.GRD_DATE, ";
        $query .= "     T2.ENT_DATE ";
        $query .= " FROM  ";
        $query .= "     SCHREG_REGD_DAT T1 ";
        $query .= "     INNER JOIN SCHREG_BASE_MST T2 ";
        $query .= "             ON T2.SCHREGNO = T1.SCHREGNO ";
        $query .= " WHERE  ";
        $query .= "     T1.YEAR = '{$model->year}' ";
        $query .= " ), ZAISEKI AS ( ";
        $query .= " SELECT  ";
        $query .= "     'R104'     AS REASON_CD, ";
        $query .= "     '在籍者数' AS REASON_NAME, ";
        $query .= "     Z04.CNT    AS M04CNT, ";
        $query .= "     Z05.CNT    AS M05CNT, ";
        $query .= "     Z06.CNT    AS M06CNT, ";
        $query .= "     Z07.CNT    AS M07CNT, ";
        $query .= "     Z08.CNT    AS M08CNT, ";
        $query .= "     Z09.CNT    AS M09CNT, ";
        $query .= "     Z10.CNT    AS M10CNT, ";
        $query .= "     Z11.CNT    AS M11CNT, ";
        $query .= "     Z12.CNT    AS M12CNT, ";
        $query .= "     Z01.CNT    AS M01CNT, ";
        $query .= "     Z02.CNT    AS M02CNT, ";
        $query .= "     Z03.CNT    AS M03CNT, ";
        $query .= "     ( Z04.CNT + Z05.CNT + Z06.CNT + Z07.CNT + Z08.CNT + Z09.CNT +  ";
        $query .= "       Z10.CNT + Z11.CNT + Z12.CNT + Z01.CNT + Z02.CNT + Z03.CNT ) AS TOTAL, ";
        $query .= "     12 AS ROW  ";
        $query .= " FROM ";
        $query .= "     (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-04-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-04-31' )) Z04 ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-05-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-05-31' )) Z05 ON Z05.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-06-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-06-31' )) Z06 ON Z06.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-07-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-07-31' )) Z07 ON Z07.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-08-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-08-31' )) Z08 ON Z08.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-09-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-09-31' )) Z09 ON Z09.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-10-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-10-31' )) Z10 ON Z10.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-11-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-11-31' )) Z11 ON Z11.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '{$model->year}-12-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '{$model->year}-12-31' )) Z12 ON Z12.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '".$nextYear."-01-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '".$nextYear."-01-31' )) Z01 ON Z01.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '".$nextYear."-02-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '".$nextYear."-02-31' )) Z02 ON Z02.JOINCD = Z04.JOINCD ";
        $query .= "     LEFT JOIN (SELECT COUNT(*) AS CNT, 'X' AS JOINCD FROM REGD WHERE  CHAR(ENT_DATE) <= '".$nextYear."-03-01' AND (GRD_DATE IS NULL OR  CHAR(GRD_DATE) < '".$nextYear."-03-31' )) Z03 ON Z03.JOINCD = Z04.JOINCD ";
        $query .= " ), LESSON AS ( ";
        $query .= " SELECT  ";
        $query .= "     'R105'     AS REASON_CD, ";
        $query .= "     '授業日数' AS REASON_NAME, ";
        $query .= "     DECIMAL(M04.LESSON) AS M04CNT, ";
        $query .= "     DECIMAL(M05.LESSON) AS M05CNT, ";
        $query .= "     DECIMAL(M06.LESSON) AS M06CNT, ";
        $query .= "     DECIMAL(M07.LESSON) AS M07CNT, ";
        $query .= "     DECIMAL(M08.LESSON) AS M08CNT, ";
        $query .= "     DECIMAL(M09.LESSON) AS M09CNT, ";
        $query .= "     DECIMAL(M10.LESSON) AS M10CNT, ";
        $query .= "     DECIMAL(M11.LESSON) AS M11CNT, ";
        $query .= "     DECIMAL(M12.LESSON) AS M12CNT, ";
        $query .= "     DECIMAL(M01.LESSON) AS M01CNT, ";
        $query .= "     DECIMAL(M02.LESSON) AS M02CNT, ";
        $query .= "     DECIMAL(M03.LESSON) AS M03CNT, ";
        $query .= "     DECIMAL(ALL.CNT)    AS TOTAL, ";
        $query .= "     13 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT YEAR FROM NURSEOFF_LESSON_DAT GROUP BY YEAR) T1 ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M04 ON M04.YEAR = T1.YEAR AND M04.MONTH = '04' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M05 ON M05.YEAR = T1.YEAR AND M05.MONTH = '05' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M06 ON M06.YEAR = T1.YEAR AND M06.MONTH = '06' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M07 ON M07.YEAR = T1.YEAR AND M07.MONTH = '07' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M08 ON M08.YEAR = T1.YEAR AND M08.MONTH = '08' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M09 ON M09.YEAR = T1.YEAR AND M09.MONTH = '09' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M10 ON M10.YEAR = T1.YEAR AND M10.MONTH = '10' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M11 ON M11.YEAR = T1.YEAR AND M11.MONTH = '11' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M12 ON M12.YEAR = T1.YEAR AND M12.MONTH = '12' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M01 ON M01.YEAR = T1.YEAR AND M01.MONTH = '01' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M02 ON M02.YEAR = T1.YEAR AND M02.MONTH = '02' ";
        $query .= "     LEFT JOIN NURSEOFF_LESSON_DAT M03 ON M03.YEAR = T1.YEAR AND M03.MONTH = '03' ";
        $query .= "     LEFT JOIN (SELECT YEAR,SUM(INTEGER(LESSON)) AS CNT FROM NURSEOFF_LESSON_DAT GROUP BY YEAR) ALL ";
        $query .= "                  ON ALL.YEAR = T1.YEAR   ";
        $query .= " WHERE ";
        $query .= "     T1.YEAR = '{$model->year}' ";
        $query .= " ), ONAV AS ( ";
        $query .= " SELECT ";
        $query .= "     'R103'            AS REASON_CD, ";
        $query .= "     '1日平均利用者数' AS REASON_NAME, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M04CNT) / FLOAT(T1.M04CNT))*10,0)/10,5,1) AS M04CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M05CNT) / FLOAT(T1.M05CNT))*10,0)/10,5,1) AS M05CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M06CNT) / FLOAT(T1.M06CNT))*10,0)/10,5,1) AS M06CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M07CNT) / FLOAT(T1.M07CNT))*10,0)/10,5,1) AS M07CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M08CNT) / FLOAT(T1.M08CNT))*10,0)/10,5,1) AS M08CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M09CNT) / FLOAT(T1.M09CNT))*10,0)/10,5,1) AS M09CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M10CNT) / FLOAT(T1.M10CNT))*10,0)/10,5,1) AS M10CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M11CNT) / FLOAT(T1.M11CNT))*10,0)/10,5,1) AS M11CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M12CNT) / FLOAT(T1.M12CNT))*10,0)/10,5,1) AS M12CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M01CNT) / FLOAT(T1.M01CNT))*10,0)/10,5,1) AS M01CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M02CNT) / FLOAT(T1.M02CNT))*10,0)/10,5,1) AS M02CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.M03CNT) / FLOAT(T1.M03CNT))*10,0)/10,5,1) AS M03CNT, ";
        $query .= "     DECIMAL(ROUND((FLOAT(T2.TOTAL) /  FLOAT(T1.TOTAL))*10,0)/10,5,1) AS TOTAL, ";
        $query .= "     11 AS ROW ";
        $query .= " FROM ";
        $query .= "   (SELECT T1.*, 'X' AS JOINCD FROM TOTAL T1) T1 ";
        $query .= "   FULL OUTER JOIN (SELECT T1.*, 'X' AS JOINCD FROM LESSON T1)T2 ON T2.JOINCD = T1.JOINCD ";
        $query .= " ),MAIN AS( ";
        $query .= " SELECT * FROM TYPE1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE3 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE5 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE3_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TOTAL ";
        $query .= " UNION ";
        $query .= " SELECT * FROM RRT ";
        $query .= " UNION ";
        $query .= " SELECT * FROM ONAV ";
        $query .= " ORDER BY ROW, REASON_CD ";
        $query .= " ), MAIN_TABLE AS( ";
        $query .= " SELECT ";
        $query .= "   T1.*, ";
        $query .= "   DECIMAL(DOUBLE(COALESCE(T1.TOTAL,0))/DOUBLE(T2.TOTAL) * 100,3,0) AS PER ";
        $query .= " FROM ";
        $query .= "   (SELECT T1.*, 'X' AS JOINCD FROM MAIN T1) T1 ";
        $query .= "   FULL OUTER JOIN (SELECT T1.*, 'X' AS JOINCD FROM TOTAL T1)T2 ON T2.JOINCD = T1.JOINCD ";
        $query .= " ORDER BY T1.ROW, T1.REASON_CD ";
        $query .= " ) ";
        $query .= " SELECT * FROM MAIN_TABLE ";
        $query .= " UNION ";
        $query .= " SELECT T1.*, 'X' AS JOINCD, DOUBLE(0) AS PER FROM ZAISEKI T1 ";
        $query .= " UNION ";
        $query .= " SELECT T1.*, 'X' AS JOINCD, DOUBLE(0) AS PER FROM LESSON T1 ";
        $query .= " ORDER BY ROW, REASON_CD ";

        return $query;
    }


    //CVS作成用のQUERY
    function selectCsvQuery2($model) {
    
        $nextYear = $model->year + 1;

        $query .= " WITH REASON01_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '01'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '01' ";
        $query .= "           OR VISIT_REASON2 = '01' ";
        $query .= "           OR VISIT_REASON3 = '01' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON02_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '02'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '02' ";
        $query .= "           OR VISIT_REASON2 = '02' ";
        $query .= "           OR VISIT_REASON3 = '02' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON03_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '03'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '03' ";
        $query .= "           OR VISIT_REASON2 = '03' ";
        $query .= "           OR VISIT_REASON3 = '03' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON04_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '04'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '04' ";
        $query .= "           OR VISIT_REASON2 = '04' ";
        $query .= "           OR VISIT_REASON3 = '04' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON05_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '05'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '05' ";
        $query .= "           OR VISIT_REASON2 = '05' ";
        $query .= "           OR VISIT_REASON3 = '05' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON06_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '06'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '06' ";
        $query .= "           OR VISIT_REASON2 = '06' ";
        $query .= "           OR VISIT_REASON3 = '06' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON07_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '07'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '07' ";
        $query .= "           OR VISIT_REASON2 = '07' ";
        $query .= "           OR VISIT_REASON3 = '07' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), REASON99_1 AS ( ";
        $query .= " SELECT  ";
        $query .= "     MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     '99'              AS VISIT_REASON, ";
        $query .= "     COUNT(*)          AS CNT ";
        $query .= " FROM  ";
        $query .= "     NURSEOFF_VISITREC_DAT ";
        $query .= " WHERE ";
        $query .= "     VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "     AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "     AND ( VISIT_REASON1    = '99' ";
        $query .= "           OR VISIT_REASON2 = '99' ";
        $query .= "           OR VISIT_REASON3 = '99' )  ";
        $query .= " GROUP BY ";
        $query .= "     MONTH(VISIT_DATE) , ";
        $query .= "     TYPE               ";
        $query .= " ), TYPE5_1 AS( ";
        $query .= " SELECT * FROM REASON01_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON02_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON03_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON04_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON05_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON06_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON07_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON99_1 ";
        $query .= " ), TYPE5_MAIN1 AS( ";
        $query .= " SELECT  ";
        $query .= "     'T1_' || N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1   AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     ( COALESCE(M04.CNT,0) + COALESCE(M05.CNT,0) + COALESCE(M06.CNT,0) +  ";
        $query .= "       COALESCE(M07.CNT,0) + COALESCE(M08.CNT,0) + COALESCE(M09.CNT,0) +  ";
        $query .= "       COALESCE(M10.CNT,0) + COALESCE(M11.CNT,0) + COALESCE(M12.CNT,0) +  ";
        $query .= "       COALESCE(M01.CNT,0) + COALESCE(M02.CNT,0) + COALESCE(M03.CNT,0) ) AS TOTAL, ";
        $query .= "     1 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN TYPE5_1 M04 ON M04.VISIT_REASON = N1.NAMECD2 AND M04.TYPE = '5' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN TYPE5_1 M05 ON M05.VISIT_REASON = N1.NAMECD2 AND M05.TYPE = '5' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN TYPE5_1 M06 ON M06.VISIT_REASON = N1.NAMECD2 AND M06.TYPE = '5' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN TYPE5_1 M07 ON M07.VISIT_REASON = N1.NAMECD2 AND M07.TYPE = '5' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN TYPE5_1 M08 ON M08.VISIT_REASON = N1.NAMECD2 AND M08.TYPE = '5' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN TYPE5_1 M09 ON M09.VISIT_REASON = N1.NAMECD2 AND M09.TYPE = '5' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN TYPE5_1 M10 ON M10.VISIT_REASON = N1.NAMECD2 AND M10.TYPE = '5' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN TYPE5_1 M11 ON M11.VISIT_REASON = N1.NAMECD2 AND M11.TYPE = '5' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN TYPE5_1 M12 ON M12.VISIT_REASON = N1.NAMECD2 AND M12.TYPE = '5' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN TYPE5_1 M01 ON M01.VISIT_REASON = N1.NAMECD2 AND M01.TYPE = '5' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN TYPE5_1 M02 ON M02.VISIT_REASON = N1.NAMECD2 AND M02.TYPE = '5' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN TYPE5_1 M03 ON M03.VISIT_REASON = N1.NAMECD2 AND M03.TYPE = '5' AND M03.MONTH = 03 ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F219' ";
        $query .= "     AND N1.NAMECD2 IN ('01','02','03','04','05','06','07','99') ";
        $query .= " ),TYPE5_TOTAL1 AS( ";
        $query .= " SELECT ";
        $query .= "     MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     SUM(CNT) AS CNT ";
        $query .= " FROM TYPE5_1 ";
        $query .= " GROUP BY  ";
        $query .= "     MONTH, ";
        $query .= "     TYPE ";
        $query .= " ),TYPE5_ALL_TOTAL1 AS( ";
        $query .= " SELECT ";
        $query .= "     TYPE, ";
        $query .= "     SUM(CNT) AS CNT ";
        $query .= " FROM TYPE5_1 ";
        $query .= " GROUP BY  ";
        $query .= "     TYPE ";
        $query .= " ), TYPE5_SUB1 AS ( ";
        $query .= " SELECT ";
        $query .= "     'T1_SUB'   AS REASON_CD, ";
        $query .= "     '延べ小計' AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     COALESCE(TAT.CNT,0) AS TOTAL, ";
        $query .= "     2 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM TYPE5_TOTAL1 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M04 ON T1.TYPE = M04.TYPE AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M05 ON T1.TYPE = M05.TYPE AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M06 ON T1.TYPE = M06.TYPE AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M07 ON T1.TYPE = M07.TYPE AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M08 ON T1.TYPE = M08.TYPE AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M09 ON T1.TYPE = M09.TYPE AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M10 ON T1.TYPE = M10.TYPE AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M11 ON T1.TYPE = M11.TYPE AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M12 ON T1.TYPE = M12.TYPE AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M01 ON T1.TYPE = M01.TYPE AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M02 ON T1.TYPE = M02.TYPE AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL1 M03 ON T1.TYPE = M03.TYPE AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN TYPE5_ALL_TOTAL1 TAT ON TAT.TYPE = T1.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '5' ";
        $query .= " ), MAIN1 AS( ";
        $query .= " SELECT * FROM TYPE5_MAIN1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE5_SUB1 ";
        $query .= " ORDER BY ROW, REASON_CD ";
        $query .= " ), REASON01_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '01'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '01' ";
        $query .= "                 OR VISIT_REASON2 = '01' ";
        $query .= "                 OR VISIT_REASON3 = '01' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON02_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '02'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '02' ";
        $query .= "                 OR VISIT_REASON2 = '02' ";
        $query .= "                 OR VISIT_REASON3 = '02' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON03_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '03'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '03' ";
        $query .= "                 OR VISIT_REASON2 = '03' ";
        $query .= "                 OR VISIT_REASON3 = '03' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON04_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '04'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '04' ";
        $query .= "                 OR VISIT_REASON2 = '04' ";
        $query .= "                 OR VISIT_REASON3 = '04' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON05_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '05'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '05' ";
        $query .= "                 OR VISIT_REASON2 = '05' ";
        $query .= "                 OR VISIT_REASON3 = '05' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON06_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '06'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '06' ";
        $query .= "                 OR VISIT_REASON2 = '06' ";
        $query .= "                 OR VISIT_REASON3 = '06' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON07_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '07'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '07' ";
        $query .= "                 OR VISIT_REASON2 = '07' ";
        $query .= "                 OR VISIT_REASON3 = '07' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), REASON99_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     T1.MONTH AS MONTH, ";
        $query .= "     T1.TYPE, ";
        $query .= "     '99'     AS VISIT_REASON, ";
        $query .= "     COUNT(*) AS CNT ";
        $query .= " FROM  ";
        $query .= "     ( SELECT  ";
        $query .= "           MONTH(VISIT_DATE) AS MONTH, ";
        $query .= "           TYPE ";
        $query .= "       FROM  ";
        $query .= "           NURSEOFF_VISITREC_DAT ";
        $query .= "       WHERE ";
        $query .= "           VISIT_DATE >= '{$model->year}-04-01' ";
        $query .= "           AND VISIT_DATE <= '".$nextYear."-03-31' ";
        $query .= "           AND ( VISIT_REASON1    = '99' ";
        $query .= "                 OR VISIT_REASON2 = '99' ";
        $query .= "                 OR VISIT_REASON3 = '99' )  ";
        $query .= "       GROUP BY ";
        $query .= "           SCHREGNO , ";
        $query .= "           MONTH(VISIT_DATE) , ";
        $query .= "           TYPE ";
        $query .= "     ) T1  ";
        $query .= " GROUP BY ";
        $query .= "     T1.MONTH , ";
        $query .= "     T1.TYPE ";
        $query .= " ), TYPE5_2 AS( ";
        $query .= " SELECT * FROM REASON01_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON02_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON03_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON04_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON05_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON06_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON07_2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM REASON99_2 ";
        $query .= " ), TYPE5_MAIN2 AS( ";
        $query .= " SELECT  ";
        $query .= "     'T2_' || N1.NAMECD2 AS REASON_CD, ";
        $query .= "     N1.NAME1   AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     ( COALESCE(M04.CNT,0) + COALESCE(M05.CNT,0) + COALESCE(M06.CNT,0) +  ";
        $query .= "       COALESCE(M07.CNT,0) + COALESCE(M08.CNT,0) + COALESCE(M09.CNT,0) +  ";
        $query .= "       COALESCE(M10.CNT,0) + COALESCE(M11.CNT,0) + COALESCE(M12.CNT,0) +  ";
        $query .= "       COALESCE(M01.CNT,0) + COALESCE(M02.CNT,0) + COALESCE(M03.CNT,0) ) AS TOTAL, ";
        $query .= "     3 AS ROW ";
        $query .= " FROM ";
        $query .= "     V_NAME_MST N1  ";
        $query .= "     LEFT JOIN TYPE5_2 M04 ON M04.VISIT_REASON = N1.NAMECD2 AND M04.TYPE = '5' AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN TYPE5_2 M05 ON M05.VISIT_REASON = N1.NAMECD2 AND M05.TYPE = '5' AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN TYPE5_2 M06 ON M06.VISIT_REASON = N1.NAMECD2 AND M06.TYPE = '5' AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN TYPE5_2 M07 ON M07.VISIT_REASON = N1.NAMECD2 AND M07.TYPE = '5' AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN TYPE5_2 M08 ON M08.VISIT_REASON = N1.NAMECD2 AND M08.TYPE = '5' AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN TYPE5_2 M09 ON M09.VISIT_REASON = N1.NAMECD2 AND M09.TYPE = '5' AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN TYPE5_2 M10 ON M10.VISIT_REASON = N1.NAMECD2 AND M10.TYPE = '5' AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN TYPE5_2 M11 ON M11.VISIT_REASON = N1.NAMECD2 AND M11.TYPE = '5' AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN TYPE5_2 M12 ON M12.VISIT_REASON = N1.NAMECD2 AND M12.TYPE = '5' AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN TYPE5_2 M01 ON M01.VISIT_REASON = N1.NAMECD2 AND M01.TYPE = '5' AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN TYPE5_2 M02 ON M02.VISIT_REASON = N1.NAMECD2 AND M02.TYPE = '5' AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN TYPE5_2 M03 ON M03.VISIT_REASON = N1.NAMECD2 AND M03.TYPE = '5' AND M03.MONTH = 03 ";
        $query .= " WHERE ";
        $query .= "     N1.YEAR = '{$model->year}' ";
        $query .= "     AND N1.NAMECD1 = 'F219' ";
        $query .= "     AND N1.NAMECD2 IN ('01','02','03','04','05','06','07','99') ";
        $query .= " ),TYPE5_TOTAL2 AS( ";
        $query .= " SELECT ";
        $query .= "     MONTH, ";
        $query .= "     TYPE, ";
        $query .= "     SUM(CNT) AS CNT ";
        $query .= " FROM TYPE5_2 ";
        $query .= " GROUP BY  ";
        $query .= "     MONTH, ";
        $query .= "     TYPE ";
        $query .= " ),TYPE5_ALL_TOTAL2 AS( ";
        $query .= " SELECT ";
        $query .= "     TYPE, ";
        $query .= "     SUM(CNT) AS CNT ";
        $query .= " FROM TYPE5_2 ";
        $query .= " GROUP BY  ";
        $query .= "     TYPE ";
        $query .= " ), TYPE5_SUB2 AS( ";
        $query .= " SELECT ";
        $query .= "     'T2_SUB'     AS REASON_CD, ";
        $query .= "     '実人数小計' AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     COALESCE(TAT.CNT,0) AS TOTAL, ";
        $query .= "     4 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM TYPE5_TOTAL2 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M04 ON T1.TYPE = M04.TYPE AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M05 ON T1.TYPE = M05.TYPE AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M06 ON T1.TYPE = M06.TYPE AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M07 ON T1.TYPE = M07.TYPE AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M08 ON T1.TYPE = M08.TYPE AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M09 ON T1.TYPE = M09.TYPE AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M10 ON T1.TYPE = M10.TYPE AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M11 ON T1.TYPE = M11.TYPE AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M12 ON T1.TYPE = M12.TYPE AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M01 ON T1.TYPE = M01.TYPE AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M02 ON T1.TYPE = M02.TYPE AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN TYPE5_TOTAL2 M03 ON T1.TYPE = M03.TYPE AND M03.MONTH = 03 ";
        $query .= "     LEFT JOIN TYPE5_ALL_TOTAL2 TAT ON TAT.TYPE = T1.TYPE ";
        $query .= " WHERE ";
        $query .= "    T1.TYPE = '5' ";
        $query .= " ), MAIN2 AS( ";
        $query .= " SELECT * FROM TYPE5_MAIN2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE5_SUB2 ";
        $query .= " ORDER BY ROW, REASON_CD ";
        $query .= " ), TYPE3_1 AS( ";
        $query .= " SELECT  ";
        $query .= "     'R100'     AS REASON_CD, ";
        $query .= "     '延べ人数' AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     ( COALESCE(M04.CNT,0) + COALESCE(M05.CNT,0) + COALESCE(M06.CNT,0) +  ";
        $query .= "       COALESCE(M07.CNT,0) + COALESCE(M08.CNT,0) + COALESCE(M09.CNT,0) +  ";
        $query .= "       COALESCE(M10.CNT,0) + COALESCE(M11.CNT,0) + COALESCE(M12.CNT,0) +  ";
        $query .= "       COALESCE(M01.CNT,0) + COALESCE(M02.CNT,0) + COALESCE(M03.CNT,0) ) AS TOTAL, ";
        $query .= "     5 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM REASON04_1 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN REASON04_1 M04 ON M04.TYPE = T1.TYPE AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN REASON04_1 M05 ON M05.TYPE = T1.TYPE AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN REASON04_1 M06 ON M06.TYPE = T1.TYPE AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN REASON04_1 M07 ON M07.TYPE = T1.TYPE AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN REASON04_1 M08 ON M08.TYPE = T1.TYPE AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN REASON04_1 M09 ON M09.TYPE = T1.TYPE AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN REASON04_1 M10 ON M10.TYPE = T1.TYPE AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN REASON04_1 M11 ON M11.TYPE = T1.TYPE AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN REASON04_1 M12 ON M12.TYPE = T1.TYPE AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN REASON04_1 M01 ON M01.TYPE = T1.TYPE AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN REASON04_1 M02 ON M02.TYPE = T1.TYPE AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN REASON04_1 M03 ON M03.TYPE = T1.TYPE AND M03.MONTH = 03 ";
        $query .= " WHERE ";
        $query .= "     T1.TYPE = '3' ";
        $query .= " ), TYPE3_2 AS( ";
        $query .= " SELECT  ";
        $query .= "     'R101'   AS REASON_CD, ";
        $query .= "     '実人数' AS REASON_NAME, ";
        $query .= "     COALESCE(M04.CNT,0) AS M04CNT, ";
        $query .= "     COALESCE(M05.CNT,0) AS M05CNT, ";
        $query .= "     COALESCE(M06.CNT,0) AS M06CNT, ";
        $query .= "     COALESCE(M07.CNT,0) AS M07CNT, ";
        $query .= "     COALESCE(M08.CNT,0) AS M08CNT, ";
        $query .= "     COALESCE(M09.CNT,0) AS M09CNT, ";
        $query .= "     COALESCE(M10.CNT,0) AS M10CNT, ";
        $query .= "     COALESCE(M11.CNT,0) AS M11CNT, ";
        $query .= "     COALESCE(M12.CNT,0) AS M12CNT, ";
        $query .= "     COALESCE(M01.CNT,0) AS M01CNT, ";
        $query .= "     COALESCE(M02.CNT,0) AS M02CNT, ";
        $query .= "     COALESCE(M03.CNT,0) AS M03CNT, ";
        $query .= "     ( COALESCE(M04.CNT,0) + COALESCE(M05.CNT,0) + COALESCE(M06.CNT,0) +  ";
        $query .= "       COALESCE(M07.CNT,0) + COALESCE(M08.CNT,0) + COALESCE(M09.CNT,0) +  ";
        $query .= "       COALESCE(M10.CNT,0) + COALESCE(M11.CNT,0) + COALESCE(M12.CNT,0) +  ";
        $query .= "       COALESCE(M01.CNT,0) + COALESCE(M02.CNT,0) + COALESCE(M03.CNT,0) ) AS TOTAL, ";
        $query .= "     6 AS ROW ";
        $query .= " FROM ";
        $query .= "     (SELECT TYPE FROM REASON04_2 GROUP BY TYPE) T1 ";
        $query .= "     LEFT JOIN REASON04_2 M04 ON M04.TYPE = T1.TYPE AND M04.MONTH = 04 ";
        $query .= "     LEFT JOIN REASON04_2 M05 ON M05.TYPE = T1.TYPE AND M05.MONTH = 05 ";
        $query .= "     LEFT JOIN REASON04_2 M06 ON M06.TYPE = T1.TYPE AND M06.MONTH = 06 ";
        $query .= "     LEFT JOIN REASON04_2 M07 ON M07.TYPE = T1.TYPE AND M07.MONTH = 07 ";
        $query .= "     LEFT JOIN REASON04_2 M08 ON M08.TYPE = T1.TYPE AND M08.MONTH = 08 ";
        $query .= "     LEFT JOIN REASON04_2 M09 ON M09.TYPE = T1.TYPE AND M09.MONTH = 09 ";
        $query .= "     LEFT JOIN REASON04_2 M10 ON M10.TYPE = T1.TYPE AND M10.MONTH = 10 ";
        $query .= "     LEFT JOIN REASON04_2 M11 ON M11.TYPE = T1.TYPE AND M11.MONTH = 11 ";
        $query .= "     LEFT JOIN REASON04_2 M12 ON M12.TYPE = T1.TYPE AND M12.MONTH = 12 ";
        $query .= "     LEFT JOIN REASON04_2 M01 ON M01.TYPE = T1.TYPE AND M01.MONTH = 01 ";
        $query .= "     LEFT JOIN REASON04_2 M02 ON M02.TYPE = T1.TYPE AND M02.MONTH = 02 ";
        $query .= "     LEFT JOIN REASON04_2 M03 ON M03.TYPE = T1.TYPE AND M03.MONTH = 03 ";
        $query .= " WHERE ";
        $query .= "     T1.TYPE = '3' ";
        $query .= " ), MAIN3 AS( ";
        $query .= " SELECT * FROM TYPE3_1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM TYPE3_2 ";
        $query .= " ORDER BY ROW, REASON_CD ";
        $query .= " ) ";
        $query .= " SELECT * FROM MAIN1 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM MAIN2 ";
        $query .= " UNION ";
        $query .= " SELECT * FROM MAIN3 ";
        $query .= " ORDER BY ROW,REASON_CD ";


        return $query;
    }
}
?>
