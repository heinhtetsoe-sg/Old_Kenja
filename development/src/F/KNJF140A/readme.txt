# $Id: ca2be673a912a2f52ba56990419fb12cdceaaea8 $

2009/11/11  1.KNJF140を元に新規作成

2010/06/17  1.「MEDEXAM_DET_DAT」のフィールド追加に伴う修正

2010/08/05  1.「MEDEXAM_DET_DAT」のフィールド追加、サイズ変更に伴う修正

2012/06/19  1.健康診断（歯･口腔）のその他疾病及び異常を変更した。
            -- ヘッダー例を変更した。
            -- コードが"99"のときだけ更新するようにした。

2012/06/28  1.健康診断（一般）を修正した。
            -- 心臓管理区分（MANAGEMENT_DIV）の名称マスタチェックのコードを「F091」に変更した。
            -- ヘッダー例を変更した。（処理年度、処理日付）
            2.健康診断（歯・口腔）を修正した。
            -- 歯石沈着、要精検歯数、学校歯科医事後処置コード追加
            -- ヘッダー例を変更した。（処理年度、処理日付）
            3.ラベル機能を追加した。

2012/08/28  1.XLS出力処理追加
            -- プロパティー追加：useXLS(何かセットされていれば、XLS出力。基本'1'をセット。)
            -- 単独で呼び出された場合閉じる
            -- 親から呼ばれた場合は、親の権限を使用する
            -- 拡張子チェック追加

2012/12/13  1.エラーメッセージ取込先テーブル修正
            2.エラーメッセージ取込時のDBエラー対応
            
2013/06/03  1.熊本仕様プロパティprintKenkouSindanIppan = 2の時の仕様を追加
            2.XLS出力用の熊本仕様のパラメータを追加

2014/02/25  1.文言修正

2014/05/02  1.歯科で、printKenkouSindanIppan == "2"の処理は、２ OR ３に修正
            2.printKenkouSindanIppan == "2"の場合、視力【未】を登録可にする。
            3.printKenkouSindanIppan == "2"の場合、に使用する項目を追加
            4.初期値設定

2014/05/07  1.健康診断（歯・口腔）のヘッダー例を変更

2014/08/07  1.ログ取得機能追加

2015/03/24  1.歯肉の状態の名称マスタを「F510」から「F513」に変更

2015/03/25  1.printKenkouSindanIppan=2のとき、下記を修正
            -- 尿（蛋白・糖・潜血）の２次が未選択の場合、対象外'98'をセット
            -- メッセージ入力欄を追加
            -- 目の疾病及び異常、耳鼻咽頭疾患にコンボを各3つ追加、既存のコンボは必須入力に変更

2016/05/09  0.KNJF010Aで2016.04.14以降の修正分対応
            -- ・項目名変更。脊柱・胸郭 ==> 脊柱・胸郭・四肢
            -- ・プロパティprintKenkouSindanIppan=1　の時、
            -- 　項目名変更。結核欄の「病名」==>「疾病及び異常」
            -- 　但し、宮城県（名称マスタ「Z010」miyagiken）は「病名」と表示。
            -- ・printKenkouSindanIppan=2の時ではなく、常に表示するに変更。
            -- 　心臓管理所見(MANAGEMENT_REMARK)
            -- 　その他疾病指導区分所見(OTHER_REMARK)

2016/06/09  1.一般の尿の名称マスタ変更にともない修正
            -- 蛋白「F020」
            -- 糖　「F020」===>「F019」
            -- 潜血「F020」===>「F018」

2016/09/21  1.年度学期コンボ、年組コンボ、データ出力、取込時の在籍チェック修正
            -- プロパティー「useSchool_KindField」とSCHOOLKINDの参照

2017/04/05  1.CSV出力データの母集団をSCHREG_REGD_DATに変更

2017/04/10  1.CSV出力データに、項目:氏名 を追加

2017/04/18  1.CSV出力データに、２項目:年組、出席番号 を追加
            2.前回の再修正、年組(HR_NAME)を学年(GRADE)、組(HR_CLASS)に変更

2017/05/22  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            --プロパティー追加：use_prg_schoolkind

2017/05/25  1.CSV処理で、歯列・咬合を別々に出力、取込
            --プロパティー「printKenkouSindanIppan」= "1"かつ名称マスタ「Z010」が"mieken"のとき

2017/09/08  1.校種コンボ追加
            2.健康診断（一般）修正
            -- KNJF010Aのrev1.40～1.56の修正分を追加
            3.健康診断（歯・口腔）修正
            -- KNJF020のrev1.43～1.56の修正分を追加

2017/12/11  1.健康診断（一般）の備考を180桁→300桁に変更
            -- rep-medexam_det_dat.sql(rev.57437)

2018/03/20  1.熊本改修（Z010=="kumamoto"）
            --ヘッダ出力は「歯列」、「咬合」を「歯列・咬合」に変更
            --データ出力は2016年度入学生以降は「歯列」、「咬合」を「歯列・咬合」に変更

2018/03/22  1.熊本改修（Z010=="kumamoto"）条件修正

2018/06/12  1.以下の修正
            --宮城は、色覚異常カット
            --事後措置2追加
            --結核の疾病及び異常所見、その他疾病及び異常所見、事後措置所見追加
            --学校医所見コード
            --宮城県は、歯石沈着、矯正をカット
            --学校歯科医所見、事後措置所見追加

2018/09/07  1.健康診断（一般）で、「視力測定不能」の出力/取込処理を追加

2018/12/11  1.REMARKのサイズ。近大：180、以外：300
            -- 近大のバージョンアップでIF文をカットするそう
            -- 2018/12/10 19:14のメール

2019/01/18  1.CSV出力の文字化け修正(Edge対応)

2019/02/07  1.以下の修正
            --視力左右それぞれに、測定困難追加
            --聴力左右それぞれに、測定困難追加
            --Z010 "fukuiken"の時、座高カット、肥満度、視力・数字入力、貧血を追加
            --特別支援の時（プロパティ useSpecial_Support_School == "1"）その他疾病及び異常、備考は全角100文字まで

2019/03/06  1.宮城県の時、座高カット、その他疾病及び異常２、その他疾病及び異常３を追加
            --口腔の疾病及び異常コンボをカット

2019/03/15  1.福井県の時、聴力の「平均dB」、「4000Hz」カット

2019/03/19  1.特別支援の時（プロパティ useSpecial_Support_School == "1"）
            --聴力、装用時の項目を追加「平均dB」、「4000Hz」、「状態」

2019/09/11  1.LICENSE_GROUP_STD_YDATに登録されている生徒は出力しないよう修正
            --プロパティー「useLicenseMedexam」が'1'の場合

2019/12/17  1.プロパティ「unEar_db」=="1"の時、聴覚についてはZ010=="fukuiken"の時と同等のCSV出力/取込となるよう、変更
            --プロパティー「unEar_db」が'1'の場合

2020/02/10  1.広工大の時、以下の修正
            --視力は、数値入力にして、文字入力は名称マスタ「F017」を参照する
            --文言変更「平均db」→「1000Hz」

2020/03/24  1.三重の場合、事後措置に関するテキストデータを出力/取込しないよう、変更
            2.三重の場合、結核の疾病及び異常、その他疾病及び異常、事後措置のテキストを出力/取込しないよう、変更。
            3.三重の場合、学校医所見のコンボ選択データを出力/取込するよう、変更
            4.三重の場合、学校歯科医所見、事後処置のテキストを出力/取込しないよう、変更
            -- 1.～5.の修正は、2018/06/12の修正について三重では対応しない状態になるようにする変更)

2020/04/22  1.駒澤の場合、聴力の項目が入出力できるよう、変更
            2.駒澤の場合、心電図Noの項目が入出力できるよう、変更
            -- V_MEDEXAM_DET_DATにR_EAR_DB_1000、L_EAR_DB_1000、HEART_GRAPH_NO追加

2020/08/28  1.CSV DUMMYの名称をLASTCOLUMNに修正

2020/10/20  1.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_OTHERDISESE_HYOUJI」= '3' の時
            -- CSV項目「口腔の疾病及び異常2」「口腔の疾病及び異常3」を出力するよう修正
            2.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_DENTISTREMARK_HYOUJI」= '3' の時
            -- CSV項目「学校歯科医所見2」「学校歯科医所見3」を出力するよう修正
            3.ソースの自動整形を適用

2020/10/20  1.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「F020_DENTISTREMARK_HYOUJI2」= '3' の時
            -- CSV項目「その他疾病及び異常２」「その他疾病及び異常３」を出力するよう修正

2020/10/29  1.「視力（数字）」のゼロ埋めは、福井県の時のみ行うよう修正

2020/12/02  1.リファクタリング
            2.CSVの最終列をDUMMYかLASTCOLUMNで扱うかを
              設定ファイル「prgInfo.properties」のプロパティー「csv_LastColumn」で
              切り替えるように変更

2020/02/03  1.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「KenkouSindan_Ippan_Pattern」 = '1'の時
              下記を対応
              ・CSV入出力項目として、尿検査(一次、二次共)にＰＨを追加
              ・その他疾患異常を皮膚疾患の次に出力するよう、変更する。
              ・「歯列・咬合」を「歯列」、「咬合」の別項目とする。
              ・項目名称「歯垢の状態」を「歯垢の付着」へ変更する。
              ・項目「顎関節」を「咬合」の後ろに移動する。
              ・項目「歯石沈着」は入出力しないよう、変更する。

2021/03/02  1.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「KenkouSindan_Ippan_Pattern」 = '1'の時
              聴力のCSV入出力を駒澤と同様の処理となるよう、変更

2021/03/04  1.CSVメッセージ統一(SG社)

2021/03/05  1.hideSitHeightプロパティが立っている時、座高が非表示となるよう、変更(※熊本でも同様)
            -- hideSitHeightプロパティ追加
            2.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「KenkouSindan_Ippan_Pattern」 = '1'の時
              その他疾患異常を皮膚疾患の次に出力するよう、変更する(2020/02/03の反映漏れ対応)。
              
2021/03/10  1.京都PHPバージョンアップ対応

2021/03/24  1.プロパティー「printKenkouSindanIppan」= '1'かつ、 プロパティー「KenkouSindan_Ippan_Pattern」 = '1'の時
              歯石沈着が出力されないよう、修正
            2.リファクタリング
            3.取込時のエラーログ削除/登録処理が正しく呼び出されるよう、修正
            4.更新時の在籍データチェック処理が正しく判定されるよう、修正

2021/03/26  1.CSV取込時、既往歴1、既往歴2、既往歴3の0埋め処理を行わないよう、変更
