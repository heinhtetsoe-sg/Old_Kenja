<?php

require_once('for_php7.php');


class knjh181Query extends Query {

    function getSemeName() {
        $query .= " SELECT ";
        $query .= "     SEMESTERNAME ";
        $query .= " FROM ";
        $query .= "     SEMESTER_MST ";
        $query .= " WHERE ";
        $query .= "     YEAR = '".CTRL_YEAR."' ";
        $query .= "     AND SEMESTER = '".CTRL_SEMESTER."' ";

        return $query;
    }

    function getRosen($model) {
        $query .= " WITH MAIN_T AS ( ";
        $query .= " SELECT ";
        $query .= "     T1.* ";
        $query .= " FROM ";
        $query .= "     SCHREG_ENVIR_DAT T1 ";
        $query .= "     INNER JOIN SCHREG_REGD_DAT I1 ON I1.YEAR = '".CTRL_YEAR."' ";
        $query .= "           AND I1.SEMESTER = '".CTRL_SEMESTER."' ";
        $query .= "           AND T1.SCHREGNO = I1.SCHREGNO ";
        $query .= " ), ROSEN_T AS ( ";
        $query .= " SELECT ";
        $query .= "     MAX(MAIN.SCH) AS SCH, ";
        $query .= "     MAIN.ROSEN ";
        $query .= " FROM ( ";
        $query .= "     SELECT ";
        $query .= "         '1_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_1 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_1 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_1 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '2_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_2 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_2 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_2 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '3_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_3 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_3 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_3 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '4_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_4 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_4 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_4 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '5_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_5 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_5 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_5 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '6_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_6 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_6 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_6 ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         '7_' || MAX(T1.SCHREGNO) AS SCH, ";
        $query .= "         T1.ROSEN_7 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_7 = '2' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     GROUP BY ";
        $query .= "         T1.ROSEN_7 ";
        $query .= "     ) MAIN ";
        $query .= " WHERE ";
        $query .= "     MAIN.ROSEN <> 'ã€€' ";
        $query .= "     AND MAIN.ROSEN <> ' ' ";
        $query .= " GROUP BY ";
        $query .= "     MAIN.ROSEN ";
        $query .= " ) ";
        $query .= " SELECT ";
        $query .= "     ROSEN_T.SCH AS VALUE, ";
        $query .= "     ROSEN_T.ROSEN AS LABEL ";
        $query .= " FROM ";
        $query .= "     ROSEN_T ";
        $query .= " ORDER BY ";
        $query .= "     ROSEN_T.ROSEN ";

        return $query;
    }

    function getTrainLine($model) {
        $query .= " WITH MAIN_T AS ( ";
        $query .= " SELECT ";
        $query .= "     T1.* ";
        $query .= " FROM ";
        $query .= "     SCHREG_ENVIR_DAT T1 ";
        $query .= "     INNER JOIN SCHREG_REGD_DAT I1 ON I1.YEAR = '".CTRL_YEAR."' ";
        $query .= "           AND I1.SEMESTER = '".CTRL_SEMESTER."' ";
        $query .= "           AND T1.SCHREGNO = I1.SCHREGNO ";
        $query .= " ), ROSEN_T AS ( ";
        $query .= " SELECT ";
        $query .= "     MAIN.ROSEN ";
        $query .= " FROM ( ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_1 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_1 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_2 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_2 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_3 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_3 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_4 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_4 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_5 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_5 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_6 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_6 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     UNION ";
        $query .= "     SELECT ";
        $query .= "         T1.ROSEN_7 AS ROSEN ";
        $query .= "     FROM ";
        $query .= "         MAIN_T T1 ";
        $query .= "     WHERE ";
        $query .= "         T1.FLG_7 = '1' ";
        $query .= "         AND T1.UP_DOWN = '{$model->field["UP_DOWN"]}' ";
        $query .= "     ) MAIN ";
        $query .= " GROUP BY ";
        $query .= "     MAIN.ROSEN ";
        $query .= " ) ";
        $query .= " SELECT ";
        $query .= "     ROSEN_T.ROSEN AS VALUE, ";
        $query .= "     L1.LINE_NAME AS LABEL ";
        $query .= " FROM ";
        $query .= "     ROSEN_T ";
        $query .= "     LEFT JOIN TRAIN_LINE_MST L1 ON ROSEN_T.ROSEN = L1.LINE_CD ";
        $query .= " ORDER BY ";
        $query .= "     VALUE ";

        return $query;
    }
}
?>
