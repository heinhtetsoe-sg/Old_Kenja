# kanji=漢字
# $Id: readme.txt 76509 2020-09-07 08:31:02Z arakaki $
/*** KNJX140 基本時間割ＣＳＶ出力／取込 readme.txt***/

2005.12.08 作成
2006.01.19 仕様をreadme.txtに記述
2007.02.19 エラー出力を追加。デザイン統一。仕様を追記
====================== ここから =====================================
基本時間割CSV処理 - KNJX140
----
以下は仕様
■主なテーブル
・sch_ptrn_hdat
・sch_ptrn_dat
・sch_ptrn_stf_dat

■各テーブルの関係図
(1) sch_ptrn_hdat
        |
        +--- (2) sch_ptrn_dat
                |
                +--- (3) sch_ptrn_stf_dat

■CSVデータ取込
・主なテーブルを全て取り込む
・更新：各テーブルに追加および更新する。
- 但し、sch_ptrn_stf_dat は職員コードが入力されている場合のみ、追加および更新する。(仲本)
- sch_ptrn_dat に入って、 sch_ptrn_stf_dat に入らない(高江洲)
・削除：各テーブルを講座単位で削除する。
つまり、(2),(3)を削除する。(1)は(2)がSEQ単位で、ゼロ件の場合のみ削除する。

■CSVデータ出力
・指定された年度・学期、タイトルの基本時間割をCSV出力する。

■ヘッダ出力
・テンプレートをCSV出力する。

■エラー出力
・エラーをCSV出力する。

■ヘッダ有り チェックボックス
・CSVデータ出力および取込を実行する際、ヘッダ有り無しを選択する。

■実行ボタン
・CSVデータ出力および取込を実行する。

■CSVデータ取込時のエラーチェック
・項目チェック（桁数・必須項目・数字・値）
・存在チェック（名称マスタ（校時コード）・講座データ・職員年度データ）
・ＳＥＱチェック１(一度に取込可能なＳＥＱは、１種類のみとする)
・ＳＥＱチェック２(パターン反映履歴データに存在するＳＥＱは、取込は許可しない)
----

====================== ここまで =====================================

2011/02/24  1.CVS登録
            2.リファクタリング
            3.XLS出力処理追加
            -- プロパティー追加：useXLS(何かセットされていれば、XLS出力。基本'1'をセット。)

2011/02/28  1.encoding指定

2011/03/18  1.テンプレートを1本に統一

2011/03/30  1.以下の修正をした
            -- 単独で呼び出された場合閉じる
            -- 親から呼ばれた場合は、親の権限を使用する

2011/04/01  1.テンプレートのパス修正

2011/04/29  1.テーブルPTRN_REFLECTHIST_DATのレイアウト変更にともなうSQL修正

2011/12/28  1.SCH_PTRN_COUNTFLG_DATの更新・削除処理を追加した。

2014/07/02  1.ログ取得機能追加

2016/09/21  1.校種条件追加
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2017/09/14  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            -- プロパティー追加：use_prg_schoolkind
            
2019/06/07  1.データ出力のエラーチェック

2020/09/07  1.CSV DUMMYの名称をLASTCOLUMNに修正

2020/12/07  1.リファクタリング
            2.CSVの最終列をDUMMYかLASTCOLUMNで扱うかを
              設定ファイル「prgInfo.properties」のプロパティー「csv_LastColumn」で
              切り替えるように変更

2021/02/24  1.CSVメッセージ統一(SG社)

2021/03/10  1.京都PHPバージョンアップ対応

2021/03/18  1.LASTCOLUMの文言の後ろにある不要は文字（"age"や"AGE"）を削除

2021/04/07  1.CSVメッセージ統一(SG社)で行った、SCH_PTRN_HDATの重複チェックカット
