/*** KNJA110 学籍基礎データ入力（担任）賢者版 ***/
$Id: bcb1f852123a849ac32926da76a9fcede38a5398 $

2009/03/07 KNJA110を元に新規作成、履歴登録機能を追加

2009/04/28 1.「SCHREG_BASE_HIST_DAT」にフィールド追加に伴う修正

2009/07/16  1.PHP5に対応

2009/08/24  1.出身学校に検索ボタンを追加

2009/09/01  1.「その他」「国籍」を追加

2010/03/31  1.履歴登録

2010/03/31  1.戸籍氏名、かな追加に伴う修正
            -- rep-schreg_base_mst.sql.sql-1.6
            1.一括更新の修正
            2.チェックボックスの並び修正、終了日付修正
            3.入力可能な日付の制限を追加

2010/04/05  1.リファクタリング
            -- コメント化されている処理を削除した。
            -- インデントを修正した。
            -- オブジェクト作成をメソッドにした。
            2.日付取得方法修正

2010/04/06  1.事由の取得

2010/04/13  1.履歴修正処理追加

2010/04/16  1.学籍学歴更新処理追加

2010/04/23  1.有効期間の文言変更

2010/05/06  1.無限ループしていた。
            -- 各項目チェックエラーの場合に、コマンド設定が漏れていた。

2010/05/11  1.履歴処理修正

2010/05/18  1.履歴処理修正

2010/05/27  1.「更新後前の生徒へ」ボタンのバグ修正

2010/05/27  1.入学卒業履歴、編集機能追加
            2.入学卒業履歴、編集機能修正

2010/07/14  1.A023の略称が無くても、校種が表示できるよう修正

2010/09/21  1.一括更新での、入学卒業履歴更新処理を追加

2011/03/11  1.エラーメッセージを「リストから生徒を選択してください。」に変更した。

2011/07/21  1.入学年度を追加
            -- rep-schreg_ent_grd_hist_dat_ver1.1.sql

2011/08/29  1.学年種別を取得する際、右画面の年組コンボの学年を使用する。

2011/08/30  1.学年種別取得SQLの学年指定を元に戻した。

2011/09/05  1.年組取得を修正

2011/09/06  1.入学年度の必須チェックをカット。
            -- 必須記号「※」もカット。
            2.項目名「入学年度」を「課程入学年度」に変更。

2011/09/21  1.一括更新時の年組取得を修正

2011/10/25  1.テーブルのフィールド名が間違っていた。

2011/10/27  1.年組変更出来ない不具合を修正
            2.年組変更後の処理を修正

2011/12/12  1.一括更新処理修正。
            2.履歴データ更新時の処理を修正

2012/02/06  1.テーブル変更に伴う修正
            -- schreg_base_detail_mst_rev1.1.sql
            -- rep-schreg_ent_grd_hist_dat_rev1.2.sql
            -- v_schreg_base_mst_rev1.1.sql
            
2012/02/08  1.小学校の出身学校情報に関する修正
            -- 文字チェックを25×4行 = 300byteに修正
            -- テキストエリアの文字表示が全角25文字ごとに改行されるよう修正
            -- 入学卒業履歴画面の小学校の出身学校情報の文字チェック追加
            2.小学校の出身学校情報の入力画面を改行コード含めた306byteに修正
            -- 行数チェックを追加

2012/03/19  1.入力項目「受験番号」追加に伴い修正
            -- SCHREG_BASE_DETAIL_MSTのBASE_SEQ=003のBASE_REMARK1

2013/04/01  1.履歴のチェックボックスに一つもチェックがなければエラーチェックしない。

2013/04/03  1.受験番号のサイズを可変にする。(プロパティー：examnoLen)

2013/04/04  1.履歴の有効終了日をログイン日付以降も指定できるように修正した。

2013/04/18  1.写真アップロード機能追加(useJpgUpload)

2013/07/08  1.一括処理で、SCHREG_ENT_GRD_HIST_DATの更新があった場合は
              SCHREG_ENT_GRD_HIST_DATのMAX(A023参照)で、SCHREG_BASE_MSTを上書きする。

2013/12/07  1.住所のサイズ変更等に伴う修正
            -- rep-guardian_address_dat_rev1.5.sql
            -- rep-schreg_address_dat_rev1.9.sql
            -- rep-schreg_base_mst_rev1.9.sql
            -- rep-schreg_base_mst_rev1.9.sql
            -- rep-schreg_ent_grd_hist_dat_rev1.4.sql
            -- v_schreg_base_mst_rev1.5.sql

2013/12/25  1.プロパティー「useAddrField2」を追加した。
            -- '1'がセットされている場合は追加分の住所2を使用する。

2014/04/02  1.卒業区分：1/2/3の場合は、次年度のCLASS_FORMATION_DATを削除する。
            2.卒業日付の年度内チェックを追加。

2014/04/21  1.IEバージョンによる、ポップアップの表示位置修正

2014/05/01  1.入学卒業履歴に、除籍時のバックアップデータも表示する。

2014/05/19  1.復学ありの生徒は、入学欄に入学日を出力する。(復学履歴のMIN)
            2.学籍基礎データ削除時に削除対象のデータはDELBK_*テーブルにバックアップを取るよう修正

2014/05/26  1.更新/削除等のログ取得機能を追加
            2.学籍基礎データ削除時のバックアップ処理修正 (共通関数を使う)
            
2014/06/26  1.学籍基礎データ削除時のバックアップ処理を一旦コメントアウト(後日、環境が整い次第復活させる)
            2.除籍の履歴の校種の「(除籍)」をカット
            3.除籍の履歴の背景色を変更
            
2014/11/10  1.プロパティuseOnlineLink = 1のとき、学籍基礎1,2のリンクを追加
                - /usr/local/development/sousaManual/KNJA110A_1を参照
                - /usr/local/development/sousaManual/KNJA110A_2を参照

2014/12/18  1.検索条件追加に伴い、学校検索の呼び出し時のウインドウサイズを変更

2015/03/31  1.削除ボタンをカット

2015/04/15  1.一括更新画面で、更新されない不具合修正

2015/06/04  1.JavascriptのgetYear()メソッドをgetFullYear()メソッドに変更

2015/06/12  1.氏名等履歴の予約機能追加

2015/06/18  1.入学卒業履歴修正画面で、小学校の時は学校名をNYUGAKUMAE_SYUSSIN_JOUHOUより表示するよう修正

2015/11/12  1.プロパティー「useAddrField2」だけではなく、SCHOOL_KIND='H'の時は、ENT_ADDR2およびGRD_ADDR2を表示する
                - ただし、項目名は課程・学科等とする
            2.転学先学年を追加
            3.多数のバグ修正

2015/11/13  1.履歴画面の課程学科フラグを課程フラグ、学科フラグに分けた。

2015/11/16  1.getStudent_data_beforeの引数が足りなかったので修正

2016/01/15  1.顔写真の表示/非表示機能(useDispUnDispPicture)

2016/01/18  1.その他（身体状態）をSCHREG_BASE_YEAR_DETAIL_MST(BASE_SEQ='004')にも更新するよう修正
            -- SCHREG_BASE_MSTのその他（身体状態）は常に最新データを保持するよう修正
            
2016/02/02  1.備考1,2,3の入力文字の制限以降は入力できないよう修正

2016/02/12  1.幼稚園の時は学校名をNYUGAKUMAE_SYUSSIN_JOUHOUより表示するよう修正
            2.一括更新画面も小学校・幼稚園の時は学校名をNYUGAKUMAE_SYUSSIN_JOUHOUより表示するよう修正

2016/03/26  1.不具合修正

2016/09/16  1.課程学科コンボ、コースコンボに空行追加

2016/06/20  1.校種条件追加
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2016/11/25  1.出身学校手入力用プロパティー追加
            -- プロパティー「use_finSchool_teNyuryoku_校種」= 1の時手入力

2017/02/13  1.卒業欄のレイアウト変更

2017/02/15  1.転学先前日の校種による表示制限をカット

2017/02/20  1.出身学校手入力用プロパティー追加(SubForm1.phpとSubEntGrd.php)
            -- プロパティー「use_finSchool_teNyuryoku_校種」= 1の時手入力

2017/02/22  1.2017/02/20の修正漏れ

2017/04/18  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            -- プロパティー追加：use_prg_schoolkind

2017/04/19  1.MENUからのパラメーター受け取りは、Model.phpで行う
            2.履歴修正画面の校種制御
            3.2017/02/15  1.の修正は間違い、元に戻した。

2017/04/28  1.出身塾コンボを塾・教室コードに変更、検索ボタン追加

2017/08/23  1.入学卒業履歴修正で、項目"卒期"と"卒No"を追加

2017/09/13  1.第二国籍追加
            -- rep-schreg_base_hist_dat.sql(1.1)

2017/09/19  1.新規プログラム登録漏れ
            -- knja110aNationality2*

2017/09/29  1.卒期、卒業番号の自動セット・クリア処理をカット
            2.生徒履歴修正画面の更新時の必須チェックから第二国籍氏名をカット

2017/10/10  1.生徒履歴修正画面の一覧のリンク表示を修正

2017/10/16  1.プロパティーuseFinschoolcdFieldSizeが12ならコードの0埋め、チェックを12桁でおこなう

2017/11/28  1.新規ボタン追加
            -- プロパティー「useAutoNumbering」= 1のとき表示
            -- 学籍番号が空のとき、使用可。MAX学籍番号が自動付番される。

2017/12/18  1.フィールドサイズ変更
            -- REMARK1～3　varchar(75)　→ varchar(150)
            -- rep-schreg_base_mst.sql(rev.57554)

2018/03/13  1.フィールド追加に伴う修正
            -- SCHREG_BASE_HIST_DAT.HANDICAP, SCHREG_BASE_HIST_DAT.HANDICAP_FLG
            -- rep-schreg_base_hist_dat.sql(rev.59114)

2018/05/08  1.英字氏名でカンマが入っていても登録出来るよう修正

2018/05/09  1.入試区分追加

2018/05/10  1.2018/05/08修正を破棄

2018/05/31  1.出身中学校テキストをクリックすると第２国籍のポップアップが表示される不具合を修正

2018/07/12  1.生徒履歴修正画面にuse_prg_schoolkind設定追加
            2.KNJA110Bの機能を追加

2018/07/17  1.生活管理情報ボタンは、生徒を選択するまではグレーアウト

2018/08/29  1.茗渓は入試区分の参照先を変更

2019/08/20  1.備考追加ボタンを追加
            -- プロパティー「useBaseRemarkFlg」= 1のとき表示

2019/08/22  1.左画面の校種コンボ用パラメーター追加(URL_SCHOOLKIND)

2020/10/14  1.生徒履歴修正／入学卒業履歴修正／一括更新画面移動後に更新すると、画面が初期化される不具合を修正

2020/11/11  1.プロパティー「NAME_INPUT_SIZE」に値が設定されている時、氏名、戸籍氏名の入力文字数がこのプロパティ値以下かチェックするよう、変更
              ※未設定時は既存値。
            2.プロパティー「chkNameInputHankaku」= 1の時、氏名、戸籍氏名に半角文字が混ざっていないか、チェックするよう、変更

            -- プロパティー「NAME_INPUT_SIZE」追加
            -- プロパティー「chkNameInputHankaku」追加

2020/11/12  1.プロパティー「chkNameInputHankaku」= 1の時に行う全角文字列判定処理を修正
            2.バイト数/文字数判定の判別処理を修正

2020/12/03  1.学校検索画面のプログラムで呼び出す関数を空定義

2020/12/23  1.リファクタリング
            2.駒澤の場合、入試区分の代わりに"類別"を表示するよう修正

2020/12/28  1.駒澤で"類別"を表示する際の参照先を変更
            2.2020/12/23の2の修正ミス訂正

2021/01/05  1.リファクタリング
            2.プロパティー「Origin_hyouji」= 1の時、出身の項目を表示し、追加および更新処理でSCHREG_BASE_DETAIL_MST(BASE_SEQ='016')のBASE_REMARK1を更新するよう修正

2021/01/21  1.卒業日付の範囲チェックを年度内から入学日付以降へ変更
            2.卒業日付の範囲チェックの文言変更

2021/01/22  1.卒業日付の範囲チェックのループの値変更

2021/02/15  1.茗渓の場合、入試区分の箇所に2つのコンボボックスを表示し、更新時にDB登録するよう、変更
              ※コンボボックスに表示するデータは、入学年度の入試区分マスタ/受験型マスタのデータ
            2.入学卒業履歴修正で、学籍データを参照する際、入学年度のデータを参照するよう、変更

2021/03/19  1.プロパティ「useSpecial_Support_School」=1のとき、「その他」の項目名を「教育区分」と表示するよう修正
            2.プロパティ「use_finSchool_teNyuryoku_{校種}」=1のとき、「出身学校」の項目名を以下の通り表示するよう修正
            -- 校種が幼稚園(K）の場合、「入園前の状況」と表示する
            -- 校種が幼稚園(K）、かつ、プロパティ「useSpecial_Support_School」=1の場合、「入園前の状況」と表示する
            3.プロパティ「use_finSchool_teNyuryoku_{校種}」=1、かつ、プロパティ「useSpecial_Support_School」=1のとき、「出身学校」テキストエリアのスクロースバーを表示するよう修正
            4.「入学卒業履歴修正」入力画面の以下を修正
            -- プロパティ「use_finSchool_teNyuryoku_{校種}」=1のとき、「出身学校」の項目名を以下の通り表示するよう修正
              -- 校種が幼稚園(K）の場合、「入園前の状況」と表示する
              -- 校種が幼稚園(K）、かつ、プロパティ「useSpecial_Support_School」=1の場合、「入園前の状況」と表示する
            -- プロパティ「use_finSchool_teNyuryoku_{校種}」=1、かつ、プロパティ「useSpecial_Support_School」=1のとき、「出身学校」テキストエリアのスクロースバーを表示するよう修正
            5.「生徒履歴修正」入力画面の以下を修正
            -- プロパティ「useSpecial_Support_School」=1のとき、「その他」の項目名を「教育区分」と表示するよう修正

2021/03/27  1.ENTEXAM_SETTING_MSTが定義された学校では、「入試区分」の参照先を変更

2021/04/12  1.入学の「事由」を全角40文字(75バイト→120バイト）まで入力できるよう修正（「入学卒業履歴修正」画面、および、「一括更新」画面の入学「事由」欄も同様）
            -- エラーメッセージを修正（75バイトまで→全角40文字まで）

2021/04/15  1.以下を修正
            -- 入学卒業履歴修正画面で受験番号、および、入試区分の表示を追加
            -- （入試区分：茗渓は「入試種別」「入試方式」、その他は名称マスタまたは入試設定マスタの「入試区分」）
            -- 茗渓の場合、入学年度が取得できない場合に入試区分が更新できない不具合の修正（変更履歴の登録画面が表示された場合入学年度POST変数を追加）

2021/04/19  1.以下を修正
            -- 茗渓の場合、入試区分を参照するテーブルを変更（ENTEXAM_TESTDIV_MST→名称マスタ「A056」、ENTEXAM_EXAMTYPE_MST→名称マスタ「A057」）
            -- 茗渓の場合で追加の場合に入試区分を登録処理が漏れていたため処理追加
            -- 茗渓の場合に参照していた入学年度が不要になったため未使用の変数をカット
