/*** KNJD120K 成績入力処理（高校）readme.txt***/

2004/08/09 新規リリース
2004/08/30 Null値をPHP変数にセット時の値判定を対応修正 <近大-作業依頼書20040830-01>
2004/08/30 公欠・病欠コード訂正 <近大-作業依頼書20040901-01.doc>
2004/09/13 点数欄－マイナス値入力不可に修正 <近大-作業依頼書20040907-01.doc>
2004/09/17 帳票印刷プログラムコール処理追加・修正 <近大-作業依頼書20040915-02> ※ALP修正
2004/10/14 仕様追加-近大-作業依頼書20040824-01  初期表示改善
2004/10/14 仕様追加-近大-作業依頼書20040922-01  欠席(公欠・病欠)データ仕様追加・変更
2004/10/21 近大-作業依頼書20041019-01,作業依頼書20041019-02｢合計、平均、最低点、最高点の算出方法を修正しました。｣
2004/10/29 近大-作業依頼書20041029-01
2004/11/30 ｢異動生徒の成績入力制御｣近大-作業依頼書20041022-01
2004/12/09 ｢異動生徒の成績入力制御時の卒業日付チェックもれ｣近大-作業依頼書20041022-01
2005/01/11 ｢近大成績入力　得点を‘010’で入力すると‘8’になっています。｣ 近大-作業依頼書20050108-01
2005/01/30 在籍移動データに1人で、複数データがあれば、成績入力画面に同一名が複数表示される。近大-作業依頼書20050128-01
2005/02/08 ｢総合的な時間等特殊科目の成績入力対応｣近大-作業依頼書20050129
2005/03/01 ｢成績処理画面よりSHR,LHRは除く」
2005/03/02 近大-作業依頼書20050221-01｢学期平均(学期成績)、学年平均(学年成績)の作成条件追加｣
2005/03/03 ｢総合的な学習の成績入力時、管理者コントロールマスタの設定内容に関係なく学年平均の編集を可能にする。」
           総合的な学習の成績入力時、合計、平均、最高点、最低点の表示を行わない。
           総合的な学習の成績入力時、類型別学年評定(ABC)は、Nullで更新
           管理者コントロールに総学用コードを追加し、入力可不可の制御を可能とする。
2005/03/03 ALPへ送付
2005/03/04 ３学期期末入力時に留学生の学年成績がクリアされるの対応
2005/03/04 ALPへ送付
2005/03/04 総学編集時、学年平均入力値は、11,22,33以外はエラーとする。
2005/03/04 ALPへ送付
2005/03/04 留学生対応追加、
           留学生で1学期のみの成績が入力されている場合は、学年成績を算出しない。
2005/03/04 ALPへ送付
2005/03/04 1･2年生の学年成績の作成条件の追加
           1･2年生の場合、１学期平均、２学期平均、３学期期末の成績が入力されている場合に学年成績の作成を行う。
2005/03/04 ALPへ送付
2005/05/24 該当講座が未受講ならバックカラーを黄色にするのIF文へ""条件を追加
2005/06/02 更新時、権限チェック処理
2005/06/02 納品

2005/06/02 ※ALP修正「該当講座が未受講ならバックカラーを黄色にする」という仕様に、「今学期以下」という条件を追加
2005/07/01 学期平均算出 条件に中間がKK、KSの場合、学期平均を求めない。
           学期平均算出 条件整理 
                  if期末に点数が入っている{
                    if中間に点数が入っている{
                        学期平均=中間と期末の平均値
                    }else{
                        if中間がKK、KSの場合{
                                学期平均=""
                        }else{
                                学期平均=期末の点数
                        }
                    }
                  }else{
                    学期平均=期末の点数
                  }

2005/10/21 作業依頼確認書0510_001での修正
           テスト完了ボタンの追加及び関連テーブル（時間割講座テスト:sch_chr_test）への更新
           管理者コントロールによる編集可・不可の切換え未対応(仮納品)
2005/10/26 作業依頼確認書0510_001での修正 本納品
2006/02/23 alp m-yama NO001 学期平均は、講座テストの実施テスト分無ければ出力しない。
2006/03/03 alp m-yama NO002 講座テストの実施テスト登録がない場合は、学期の自動算出を元の仕様で行う。
----------以下、CVSで管理後のコメント----------
$Id: readme.txt 65947 2019-02-28 06:51:35Z nakamoto $
2006/07/19 o-naka 異動情報について、if文の条件を変更した（学籍処理日→試験日）
                  --残作業No.268の対応である。
                  --試験日の仕様は、以下の通りである。
                    ①（初期値）学籍処理日
                    ②管理者コントロール（admin_control_dat）に登録されている試験で、
                      時間割講座テスト（sch_chr_test）の試験日を取得
                        ・中間素点は中間テスト日、
                        ・期末素点と学期平均は期末テスト日
                    ③管理者コントロールで複数ＯＮになっている時は、最終のテストに登録されているテスト日
                    ④同一講座で、テスト日が複数あれば、ＭＡＸ日
2006/10/24 alp o-naka 「成績入力完了チェックの入れ忘れ防止対策」
更新時、下記の場合、メッセージを表示するように修正した。
・「成績が全て未入力」で「成績入力完了チェックあり」の場合、警告メッセージを表示する。（更新できない）
・「成績が全て入力済」で「成績入力完了チェックなし」の場合、確認メッセージを表示する。（更新するかしないかを選択する）
2007/03/15 nakamoto 仕様をreadme.txtに記述
2007/12/02 nakamoto 仕様追加。
「２学期期末が編集可能」かつ「１学期成績あり、２学期成績なし」は「学年成績なし」として学年成績、学年評定をNULLにする。
====================== ここから =====================================

◆学期成績の算出
//1学期中間または期末だけが編集可能の時
    //期末に点数が入っているときに1学期平均算出
        //試験時間割に登録がある場合
            //中間に点数が入っている場合、かつ、中間・期末の試験時間割登録がある場合、中間、期末の平均
            //中間に点数が入っていない場合、かつ、中間がKK、KSでない場合、かつ、期末のみに試験時間割登録がある場合、期末の値をセット
        //試験時間割に登録がない場合
            //中間に点数が入っている場合、中間、期末の平均
            //中間に点数が入っていない場合、かつ、中間がKK、KSでない場合、期末の値をセット
//2学期中間または期末だけが編集可能の時
    //期末に点数が入っているときに2学期平均算出
        //試験時間割に登録がある場合
            //中間に点数が入っている場合、かつ、中間・期末の試験時間割登録がある場合、中間、期末の平均
            //中間に点数が入っていない場合、かつ、中間がKK、KSでない場合、かつ、期末のみに試験時間割登録がある場合、期末の値をセット
        //試験時間割に登録がない場合
            //中間に点数が入っている場合、中間、期末の平均
            //中間に点数が入っていない場合、かつ、中間がKK、KSでない場合、期末の値をセット

◆学年成績の算出
//学年成績が編集不可能の時
  //１,２年生の場合
    //留学情報を持っている場合
        //１,２,３学期の平均値をセット
        //１,２学期のみの成績だけが入っている場合は１,２学期の平均値をセット
        //２,３学期のみの成績だけが入っている場合は２,３学期の平均値をセット
    //留学情報を持っていない場合
        //１,２,３学期末に点数が入っていれば学年成績算出
  //３年生の場合
        //「２学期期末が編集可能」かつ「１学期成績あり、２学期成績なし」は「学年成績なし」として学年成績、学年評定をNULLにする。 <--- 2007/12/02追加
        //１,２,３学期の平均値をセット
        //１学期のみの成績だけが入っている場合は１学期の値をセット
        //２学期のみの成績だけが入っている場合は２学期の値をセット
        //３学期のみの成績だけが入っている場合は３学期の値をセット
        //１,２学期のみの成績だけが入っている場合は１,２学期の平均値をセット
        //１,３学期のみの成績だけが入っている場合は１,３学期の平均値をセット
        //２,３学期のみの成績だけが入っている場合は２,３学期の平均値をセット

====================== ここまで =====================================
2007/12/18 nakamoto 不要なため、JUDGE_PATTERNの更新処理をカット。

2008/06/04  1.画面下段の「最高点、最低点」をそれぞれ「合計、人数」に変更した。

2008/12/07  1.３年生の学年成績の算出の不具合を修正。ゼロを空白と判断される不具合を修正。

2009/08/27  1.以下の不具合を修正。
            -- 学期成績算出において、成績がKK/KS/ブランクの場合に誤った学期成績が算出される。
            -- 中間（60）期末（KK）学期成績（60）⇒ＮＧ・・・成績入力KKの場合はブランクが正しい。
            -- 中間（KS）期末（60）学期成績（60）⇒ＮＧ・・・成績入力KSの場合はブランクが正しい。
            -- 中間（ブランク）期末（60）学期成績（60）⇒ＮＧ・・・中間テストがある場合はブランクが正しい。
            -- ※「中間テストがある／ない」について、テスト時間割を参照し判断する。

2009/09/04  1.以下の不具合を修正（管理者コントロールで中間・期末・学期成績を開いている場合）
            -- 学期成績算出において、成績がKK/KS/ブランクの場合に誤った学期成績が算出される。
            -- 中間（60）期末（KK）学期成績（60）⇒ＮＧ・・・成績入力KKの場合はブランクが正しい。
            -- 中間（KS）期末（60）学期成績（60）⇒ＮＧ・・・成績入力KSの場合はブランクが正しい。
            -- 中間（ブランク）期末（60）学期成績（60）⇒ＮＧ・・・中間テストがある場合はブランクが正しい。
            -- ※「中間テストがある／ない」について、テスト時間割を参照し判断する。

2009/09/07  1.メンバ変数の初期化を init() で処理するように変更。

2012/07/17  1.教育課程の追加、追加に伴う修正
               - Properties["useCurriculumcd"]=1のときのみ、教育課程処理に対応

2013/07/08  1.教育課程の不具合修正

2013/12/27  1.仮評定の追加対応するプロパティ追加
              - useProvFlg = '1'の時のみ対応する
            2.Enterキーによるカーソル移動機能を追加

2014/02/26  1.更新時、サブミットする項目使用不可

2014/02/28  1.更新時、サブミットする項目使用不可。ソース整理

2014/03/04  1.更新時のロック機能(レイヤ)を追加

2014/04/24  1.更新時のロック機能(レイヤ)はプロパティ「useFrameLock」= '1'の時、有効
            2.Enterキーによるカーソル移動機能修正 (※成績入力のプログラムのみ)

2016/05/19  1.コンボ選択で、成績レコードを自動作成しないように修正

2016/05/30  1.仮評定は、入力不可（グレー）に修正
            -- 更新もしないように修正
            ※ 学校からの要望

2016/07/01  1.課題研究(D065)の処理を追加
            2.前回の不具合修正
            -- 更新時、課題研究が正しく判定できていなかった。

2017/03/07  1.ADMIN_CONTROL_DATキー追加
            -- rep-admin_control_dat.sql(rev1.1)

2019/02/28  1.コピー＆貼り付け機能を追加

2021/03/03  1.コード自動整形
            2.総合的な探究の時間は総合的な学習の時間と同様に扱う

