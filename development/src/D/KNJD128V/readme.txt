// kanji=漢字
// $Id: 980d670dc6526e8b57aa276640f01ffe2e34df35 $

-----
学校：宮城県
-----

2013/06/24  1.新規。初版。
            -- 成績入力（パーツタイプ）
            2.テスト名は略称１を表示
            3.科目別設定の修正
            4.プログラムIDの変更

2013/07/17  1.算出ボタン追加に伴う修正

2013/08/22  1.DI_CD'19','20'ウイルス/DI_CD'25','26'交止追加に伴う修正
            -- rep-attend_semes_dat.sql(rev1.9)
            -- rep-attend_subclass_dat.sql(rev1.11)
            -- v_attend_semes_dat.sql(rev1.7)
            -- v_attend_subclass_dat.sql(rev1.4)
            -- v_school_mst.sql(rev1.20)
            2.DI_CD'19','20'ウイルス/DI_CD'25','26'交止追加に伴う修正漏れ対応
            
2013/12/27  1.Enterキーによるカーソル移動機能を追加

2014/01/20  1.KNJC035E呼出追加

2014/01/27  1.レイアウト幅調整
            -- 線がずれていた

2014/01/28  1.再度、レイアウト幅調整
            -- フッターのボタンを２個分左に移動

2014/02/01  1.TESTITEM_MST_COUNTFLG_NEW_SDIVのSCORE_DIV’01’の時のみ、満点マスタを参照

2014/02/25  1.追指導（記号、点数）が登録されている場合、背景色をピンク色で表示する。
            -- さらに、追指導（点数を換算後の評定が１、記号が×）の場合、文字色を赤色で表示する。

2014/02/26  1.更新時、サブミットする項目使用不可

2014/02/27  1.更新時、サブミットする項目使用不可の修正漏れ

2014/02/28  1.更新時、サブミットする項目使用不可。ソース整理

2014/03/06  1.更新時のロック機能(レイヤ)を追加

2014/04/16  1.エクセルからの貼り付け機能の不具合修正

2014/04/23  1.更新時のロック機能(レイヤ)はプロパティ「useFrameLock」= '1'の時、有効
            2.貼り付け機能の修正
                - 関数名を修正 show ⇒ showPaste
            3.Enterキーによるカーソル移動機能修正
            
2014/05/29  1.更新/削除等のログ取得機能を追加
            2.相対評定マスタの設定がある場合、相対評定マスタを参照。設定がない場合、評定マスタを参照。

2014/06/12  1.【算出】処理について、以下の不具合を修正。
            -- １期評価入力して、【算出】ボタンを押して、学年評価は表示されました。
            -- １期評価をブランクにして、【算出】ボタンを押したけど、
            -- 学年評価がブランクにならず、画面上表示が残っています。

2014/07/02  1.成績が1件も入力されていない場合、RECORD_SCORE_DATのレコードは作成しない（考査ごと）

2014/07/04  1.出欠画面へのパラメータ追加。SEND_APPDATE
            2.出欠画面を新規作成。コール先変更
            3.読込中、算出ボタンを使用不可。算出時も、サブミットする項目使用不可
            4.出欠画面に渡すパラメータ追加。SEND_SEMESTER

2014/07/17  1.小表ボタン追加。(帳票KNJD620Vを出力)

2014/09/24  1.算出ボタンの処理修正
            -- 追指導の成績が、評定マスタの評定２の下限値以上の場合、
            -- 評定マスタの評定２の下限値を元に算出
            ※ 追指導の成績が反映されない不具合対応
            2.追指導記号が○の場合、評定２の下限値を元に算出
            3.「追指導は参照する」チェックボックス追加
            4.算出ボタンの処理修正
            -- 追指導の成績が、評定マスタの評定２の下限値以上の場合、
            -- 評定マスタの評定２の下限値を元に算出
            -- 追指導の成績が、評定マスタの評定２の下限値未満の場合、
            -- 評定マスタの評定２の下限値と成績の高い方を元に算出

2014/09/25  1.異動者に黄色表示されない不具合修正

2014/09/26  1.以下の通り修正
            -- 「算出」ボタンを押した時、学年評価を算出しています。
            -- 欠課時数オーバーの人は、算出した点数を　空白にする。
            -- 「欠課時数オーバーは未履修にする」チェックボックス追加
            
2014/09/29  1.画面レイアウト修正

2014/10/02  1.科目または講座が選択されていない時、各ボタン使用不可。終了ボタン以外使用不可。

2015/04/08  1.合併先科目は、科目コンボの内容で、科目コードの前に、黒丸（●）を表示する。

2015/06/03  1.累積情報に授業時数欄を追加
            2.累積情報に授業時数欄を修正
            -- 実授業の時は、出欠集計データの授業時数でok
            -- 法定授業の時は、授業週数×単位数=値　を表示する。

2015/06/04  1.累積情報の”授業時数”を”出席すべき時数”に文言変更。

2015/06/19  1.CSVを追加
            -- 但し、名称マスタ「D058」「01」のNAMESPARE1が’1’の時は、CSVは非表示とする。
            
2015/07/03  1.ACCESS_LOG_DETAILの更新処理をコメントアウト(宮城のDBエラーからの対策)

2015/07/30  1.講座名簿に登録されている生徒より学校校種を取得し、基本設定のコードをセットするよう修正
            2.学校校種は講座名簿に登録されている生徒ではなく、科目コンボの科目より取得してセットするよう修正
                - ただし、科目コンボがNULLの場合は名称マスタA023のNAME1のMINより取得

2015/11/12  1.講座コンボ変更時、MSG108を表示する。

2015/12/02  1.顔写真表示画面を追加（氏名のリンクで表示）

2015/12/04  1.成績入力可(CONTROL_FLG='1')のテスト種別においてCSV取込不可フラグが1つでもあればCSV入出力は表示しない

2016/02/16  1.小表ボタン不具合対応（成績入力画面と内容が違う）
            -- 合併先は合併元の合算値を表示する。
            -- パラメータ出欠集計日はログイン日付とする。

2016/03/29  1.成績が別講座の生徒に上書される不具合修正
            【現象】
            -- 講座1-1選択後すぐに講座1-2を選択。
            -- 講座1-2を更新すると講座1-1の生徒に上書される。
            【原因】
            -- 生徒を表示する時に、学籍番号を保持しています。
            -- 更新は、保持した学籍番号で更新しています。
            -- 上記ケースの場合、本来、保持した学籍番号は、
            -- 講座1-2の生徒になるはずなのに、講座1-1の生徒になっている。
            【対応】
            -- 生徒を表示する時に、学籍番号を保持しておくのではなく、
            -- 更新時に、学籍番号を取得し更新するように修正。

2016/04/15  1.追指導入力設定が１つでもある場合、追指導チェックボックスを表示する。
            -- TESTITEM_MST_COUNTFLG_NEW_SDIV.SIDOU_INPUT = '1'

2016/05/24  1.プロパティKNJD128VPhotoLink=1の時、氏名に顔写真リンクを表示する。

2016/06/02  1.リファクタ。出席すべき時数欄。
            -- 授業時数欄を追加する前準備のため、変数名を変更。
            2.授業時数欄を追加。三重県から要望
            3.氏名欄に学籍番号表記を追加。三重県から要望

2016/06/06  1.以下の処理をカット
            -- 法定授業の時は、授業週数×単位数=値　を表示する。

2016/06/22  1.修正漏れ。機能していなかった。
            -- 成績入力完了チェックの入れ忘れ防止対策

2016/06/24  1.宮城県の時、成績入力完了チェックのメッセージを変更する。

2016/06/27  1.帳票へのパラメータPRINT_JUGYO_JISU追加（帳票に授業時数欄を追加）

2016/08/03  1.欠課時数オーバーの生徒に赤帯表示する。

2016/09/06  1.出欠画面のコール先変更（KNJC035E）

2016/09/19  1.科目コンボ修正
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2016/09/20  1.前回の修正漏れ
            -- プロパティー「useSchool_KindField」とSCHOOLKINDを参照

2016/09/26  1.駿台甲府要望
            -- コメント追加「欠席者には＊を入力してください」
            -- プロパティー「showBunpuHyou」が１の時、「追指導リンク」の無効化
            -- プロパティー「KNJD128V_SANSHUTU_BTN_SUM」が１の時、算出ボタンの計算方法「1:合計 それ以外:平均」

2016/10/02  1.名称マスタ「D067」「01」の各種設定を参照
            -- 予備１・・・1:総学非表示（９０未満を表示とする）
            -- 予備２・・・1:出欠入力ボタン非表示
            -- 略称１・・・小表ボタン文言「印刷」
            ※ 洛南要望
            2.修正漏れ。駿台甲府要望
            -- プロパティー「showBunpuHyou」が１の時、「□追指導は参照する」を非表示

2016/10/03  1.コメントの全角＊を半角*に修正

2016/10/12  1.講座コンボ変更時のメッセージ修正

2016/11/01  1.プロパティーuse_SchregNo_hyoji='1'の時、学籍番号表記

2016/11/28  1.プロパティー「use_school_detail_gcm_dat」が"1"の時の処理追加
            -- 新テーブルの管理者コントロールとテスト項目マスタを参照
            -- 課程学科コンボ追加
            2.帳票パラメータ追加

2017/02/27  1.処理速度改善のため、科目コンボ・講座コンボのＳＱＬ修正

2017/03/01  1.プロパティ「use_school_detail_gcm_dat = 1」かつ「課程学科が２件以上」の場合、
            -- 指定された課程学科で使用していない科目、講座を除外する。

2017/04/18  1.算出ボタンは、窓を全て閉めた時にはグレーアウト表示にする。
            ※ 宮城県要望
            2.異動日の翌日以降は、転学、退学者は入力不可にする。
            3.出欠画面のコール先変更（KNJC035F）
            4.異動日の翌日以降は、転学、退学者は入力不可にする。
            -- 但し、管理者（権限が更新可能）は、入力可

2017/04/20  1.管理者コントロールの基本のSCHOOL_KINDについて、混在は、MAXを取得する。
            -- 宮城県は'00'がある(古いデータ)
            2.異動日の翌日以降は、転学、退学者は入力不可にする。
            -- 算出処理も対象外にする。
            -- 入力窓の条件訂正
            3.出欠入力ボタンの変数名を変更

2017/04/27  1.速度改善

2017/05/16  1.ADMIN_CONTROL_PRG_SCHOOLKIND_MSTを使って、校種を制御する。
            --プロパティー追加：use_prg_schoolkind

2017/05/17  1.リファクタ。不要な校種条件をカット

2017/05/30  1.クリップボードからのコピーで*が対象となるように修正

2017/06/28  1.出欠入力のコール先を名称マスタ「D068」参照に変更

2017/07/03  1.表の線がずれる不具合修正

2017/12/05  1.算出ボタン修正。平均は満点を参照し計算する。
            --計算式「得点の合計 / (満点の合計 / 100) = 平均」

2018/03/07  1.常盤木の場合、3年生は後期中間考査(試験項目2-01-01-01、2-01-02-01等)は管理者コントロールにかかわらず、入力不可

2018/04/20  1.欠点（満点マスタの合格点未満）は、背景色（violet）をつける
            --宮城県要望（追指導の未入力が減る）

2018/04/23  1.出欠入力ボタンを押した時、警告メッセージMSG108を出力する
            ※宮城県要望

2018/04/27  1.宮城県の場合、ボタン名「小表」を「小表(確認用)」に変更
            --初期値のボタン名

2018/05/22  1.該当考査欄に見込点/参考点/備考ボタン表示
            -- プロパティー「useMikomiFlg = 1」かつ考査種別の見込点入力「あり」のとき、該当考査欄に見込点ボタン表示
            -- プロパティー「useSankouFlg = 1」かつ考査種別の参考点入力「あり」のとき、該当考査欄に参考点ボタン表示
            -- プロパティー「useRemarkFlg = 1」かつ考査種別の備考入力「あり」のとき、該当考査欄に備考ボタン表示
            -- rep-testitem_mst_countflg_new_sdiv.sql (rev.60204)
            2.欠席者で見込点があれば赤字で表示し、入力不可とする。表示例「*50」
            3.縦計に見込点を含める。また、算出ボタンも同様に見込点を含める。

2018/05/25  1.帳票パラメータ「プロパティーuseMikomiFlg」追加

2018/06/26  1.画面の罫線がずれる不具合修正
            ※宮城県から指摘

2018/07/02  1.ボタンとリンクを1行分開ける
            -- 見込点、参考点のボタンがあると追指導のリンクが見えない。

2018/07/13  1.名称マスタ「D065」登録科目の場合、名称マスタ「D001」を参照し入力値チェックする。
            ※埼玉栄から要望

2018/10/04  1.科目コンボ、講座コンボの参照・更新可（制限付き）の条件を修正
            -- 学年主任、教科主任の条件を追加

2018/10/10  1.画面の罫線がずれる不具合修正
            ※駿台適用時に砂邊さんから指摘

2018/11/29  1.プロパティーusePerfectRecordSdivDatが1なら満点マスタはPERFECT_RECORD_SDIV_DATを使用する。

2018/12/07  1.貼付機能修正
            -- テキストボックス以外も貼付けた値で更新していた

2018/12/13  1.累積現在日の取得の不具合修正

2019/03/07  1.総合的な学習の時間(D065登録科目)の年間評価の算出を修正
            ※ 埼玉栄から要望
            2.前回修正漏れ

2019/04/15  1.管理者コントロールの校種取得の際のパラメータ不足を修正

2019/06/18  1.処理速度改善

2019/09/06  1.算出ボタンの処理修正
            -- プロパティーKNJD128V_SeisekiSanshutsuPatternが1の時、KNJD219Jの割合設定を参照し算出する。
            ※ 立命館慶祥から要望

2019/09/09  1.前回の修正漏れ
            -- 算出した値を、学年末成績(9-9900-08)にもセットする
            2.前回の修正漏れ

2019/10/11  1.パラメーター追加。useChairStaffOrder

2019/10/31  1.プロパティーuseSchoolMstSemesAssesscdが1の場合、学期評価（学年末以外の990008）は満点をASSESS_HDAT.ASSESSLEVELCNT(ASSESSCDはSCHOOL_MST.SEMES_ASSESSCD)とする。（設定無しの場合、100点満点）
            2.1.の修正をカット。プロパティーuseSchoolMstSemesAssesscdが1の場合、小区分08は満点をASSESS_HDAT.ASSESSLEVELCNT(ASSESSCDはSCHOOL_MST.SEMES_ASSESSCD)とする。（設定無しの場合、100点満点）

2019/11/25  1.定期試験で欠席者が生じた場合の素点入力の仕様を以下に変更。
            --「通常の欠席」の場合、*(半角アスタリスク1個)
            --「公欠」の場合、**(半角アスタリスク2個)
            ※ただし、*と**は各学期の「中間素点」「期末素点」列のみ入力可能

2019/11/27  1."*と**は各学期の「中間素点」「期末素点」列のみ入力可能"という前回の修正が反映されていなかったため再修正

2019/11/28  1.プロパティーknjd128vTuisidousanshouCheckboxDefaltOffが1の場合、「追指導は参照するチェックボックス」の初期値をチェックなし

2019/12/06  1.プロパティーKNJD128V_SANSHUTU_BTN_un_hyojiが1の場合、算出ボタンと横の括弧を非表示

2020/04/13  1.2019/11/25～2019/11/27に追加した機能をを日大二校専用に変更
            2.入力チェックを修正

2020/04/27  1.学期評価の自動算出機能追加（専修大松戸用）
            -- 名称マスタ「Z010」「00」「NAME1」が「matsudo」の時、算出する
            2.プロパテイーknjd128vShowBtnCalcOnTopが1の場合、算出ボタンを上に表示する(下は非表示)
            -- 但し、プロパテイーKNJD128V_SANSHUTU_BTN_un_hyojiが1以外かつプロパテイーKNJD128V_SeisekiSanshutsuPatternが1以外とする

2020/05/20  1.学期評価、学年評価の計算式を追加（花園用）
            -- 名称マスタ「Z010」「00」「NAME1」が「hanazono」の時、算出する

2020/05/26  1.専修大松戸の学期評価の算出は、見込点ではなく追指導を参照する

2020/02/20  PC-Talker機能追加

2020/06/05  1.花園の場合、平常点の入力範囲は「-10～10」とする
            -- 名称マスタ「Z010」「00」「NAME1」が「hanazono」の場合

2020/06/16  1.専修大松戸の学年評価の算出を追加

2020/06/30  1.山村学園の場合、算出処理は10段階を作成する。
            -- 換算値は評定マスタの評定区分「2:学期末用評価」に設定する。
            -- 各項目名の下に算出ボタンを設けるため、プロパテイー「knjd128vShowBtnCalcOnTop = 1」を設定する。

2020/07/02  1.山村学園の学年末100「9-99-00-07」の算出処理は、算出元の平均をそのまま作成する。10段階には換算しない。

2020/07/13  1.プロパティー：useFormNameKNJD620Vに設定されたフォームで出力する。

2020/09/11  1.CSV DUMMYの名称をLASTCOLUMNに修正

2020/10/14  1.立命館守山より。見込み点有(useMikomiFlg=1)の場合、見込み点を使用して学期評点を算出

2020/10/15  1.立命館守山より。KNJD128V_SeisekiSanshutsuPattern=1の【算出】押下時、ログイン学期の学期評点を算出する。

2020/10/19  1.直近２つのコミットをロールバック

2020/12/01  1.リファクタリング
            2.CSVの最終列をDUMMYかLASTCOLUMNで扱うかを
              設定ファイル「prgInfo.properties」のプロパティー「csv_LastColumn」で
              切り替えるように変更

2020/12/14  1.リファクタリング
            2.名称マスタ'D106'に登録されている科目コードは科目コンボに表示するよう、変更

2021/03/02  1.コード自動整形
            2.青山学院の特別措置者表示機能を追加
            -- 名称マスタ「Z010」「00」「NAME1」が「aoyama」の場合
