# kanji=漢字
# $Id: 2c03172bf0f872042365fe345f4c1a25e328bc8b $

/*** KNJP170K生徒授業料軽減入力readme.txt***/
2005/05/31 PGID変更
2005/05/31 納品
2005/06/03 更新後、メッセージ追加
           総所得額編集中は更新ボタン押下不可
           軽減額確定チェックボックス一括入力対応
2005/06/03 納品
2005/08/03 Null入力時、更新ボタン押下不可のままになる。
2005/08/03 納品
2005/10/27 0509_001 特殊ケース者の文字入力対応
2005/11/18 popMsg.js呼出パス修正。
2005/11/21 軽減マスタ抽出条件、YEAR=生徒の入学年度→処理年度へ変更
2005/11/22 特殊文字列入力時、
                PREFECTURESCD
                REDUCTION_SEQ
                REDUC_INCOME
           特殊文字列(軽減額入力無し)入力時
                REDUCTIONMONEY
           をNullでクリア
2005/11/28 保護者住所を学資負担者住所へ変更。
2005/11/28 画面表示文言を保護者から学資負担者へ変更。
2005/11/30 1.特殊文字入力のときも、所得税入力と同様に、都道府県をセット。(但し0:軽減額入力無しの場合、セットしない。)
           2.特殊文字入力で0:軽減額入力無しの場合、チェックボツクスの表示は行わない。
2006/04/25 alp m-yama NO001 名称マスタ、Z006→G212に変更
                      NO002 異動情報に学籍基礎の転入等も追加
2006/08/11 m-yama \\Tokio\deve_ktest\src\P\KNJP170Kからコピー。
                  SQLを修正した。依頼兼報告表の運用18に対応。
                  学年コンボを変更した際の処理を修正。

2010/08/27  1.「REDUCTION_DAT」「REDUCTION_MST」のフィールド追加、変更に伴う修正

2010/08/28  1.前回の修正(「REDUCTION_DAT」「REDUCTION_MST」のフィールド追加、変更に伴う修正)の仕様変更
            2.「備考」の位置を変更
            3.レイアウトの微調整

2010/08/30  1.「REDUCTION_MST」の仕様変更により修正
            2.デバッグコードのコメントアウト

2010/08/31  1.以下の修正をした。
            -- NAME_MST G202の予備１＝1の場合、去年のデータでなく今年度の4～6月分を使用する。
            -- 所得額の入力桁数変更 6 → 8

2010/08/31  1.「REDUC_REMARK」のフィールドサイズ変更(24⇒30)
            2.「特殊フラグ」の仕様変更(1のとき手入力ありに修正)

2010/09/01  1.以下の通り修正
            -- 「特殊フラグ」が「NULL」の時に「所得割額」を入力しても、
            -- 「支援額」が自動で表示されない不具合を修正

2010/09/02  1.以下の通り修正
            -- [28：兵庫県]で[特殊フラグ]が[SH]の場合、
            -- 所得割額欄にどんな所得割額を入力しても
            -- 軽減補助マスタの上限・下限が[0円]の支給額を自動取得する。

2010/09/02  1.以下の修正をした。
            -- 削除 処理：所得額1、支援額1、所得額2、支援額2が全て未入力
            -- 新規/更新 処理：所得額1、支援額1、所得額2、支援額2の何れかが入力

2010/09/09  1.以下の不具合を修正。
            -- 平成20年所得割額（左）を入力し、
            -- 平成21年度所得割額（右）を入力しない学生の場合に、
            -- 更新処理をかけると、
            -- 入力していない、平成21年度所得割額（右）に、「0円」が表示される。
            2.更新ボタン押し下げ後、１秒後に更新処理を起動するように修正。
            3.２秒後に更新処理を起動するように修正。
            3.３秒後に更新処理を起動するように修正。

2010/09/10  1.現在（平成22年度でログインした時）の表示方法を変更
            -- 支援額1の
            -- 平成20年所得割額-->平成21年度所得割額　と変更（ログイン-1の年度）
            -- 支援額2の
            -- 平成21年所得割額-->平成22年度所得割額　と変更（ログインの年度） 

2010/09/13  1.以下の通り修正。
            -- 兵庫県（28）で特殊コード'SH'の場合の
            -- REDUCTION_MSTのレコード参照条件を変更。
            -- 修正前：0～0
            -- 修正後：999999～999999

2010/09/17  1.以下の不具合を修正した。
            -- 税所得割額の入力をせずに、備考欄に文言入力した場合に
            -- 更新処理後、備考欄のデータが消えてしまう。
            -- ※特殊記号「T」も同様
            -- 入力したデータ（備考欄、特殊記号ともに）が反映されるように修正した。

2010/10/13  1.異動情報の表示に「退学、転学、転入学、編入学」を追加。

2010/10/14  1.年組番号から照会画面へのリンクを追加。

2011/08/03  1.府県、国の備考欄を共通化
            -- 府県、国両方の備考欄の更新を行う。
            2.G202予備2が1の場合、軽減マスタの年度は入学年度を使用する。

2011/09/13  1.削除(入力項目が全てブランク)の更新処理で、国の備考欄をNULLで更新する。

2011/10/12  1.都道府県の名称マスタ参照時、その他選択時はコンボの都道府県を参照する。

2012/10/02  1.所得ランクを追加した。

2012/10/03  1.ランク使用の都道府県はG203で判断する。

2012/10/04  1.コピー機能追加
            2.ランクの入力方式を直接入力→右クリックからのリスト選択に変更

2012/10/10  1.修正
            2.軽減直接入力時の修正
            3.補助対象都道府県設定値の指定時処理を修正

2012/11/06  1.特殊フラグの変更による、通信エラーの修正
            2.サブミットする時は、ボタン使用不可にする。

2013/08/28  1.プログラムIDを修正

2015/01/27  1.number_formatのWarning対応

2015/09/15  1.新テーブル追加。に伴う修正(県/学年別軽減マスタ)
            -- reduction_pref_grade_mst(rev1.1)

2015/10/19  1.一年生の場合は、今年度の学年/補助金マスタで補助金額を算出する。

2015/10/20  1.修正

2016/06/30  1.補助対象都道府県設定変更機能カット
            2.学資負担者情報カット

2016/07/01  1.表示切替ラジオ追加

2016/07/08  1.大阪府のランクの仕様変更に伴う修正(G218追加)
            2.修正

2016/07/13  1.文言変更
            2.表示切替ラジオ位置変更

2016/07/19  1.交付情報のリンク文字固定 → 名称マスタG212.ABBV1に変更

2016/08/01  1.ランクのデフォルト表示機能追加
            2.固定文言変更

2016/08/29  1.交付情報複数件表示可能

2016/08/30  1.交付情報あり(01,02,03)の場合。特殊フラグ１のデフォルト値を【T】にする。

2016/09/02  1.ランクのデフォルト降順

2016/09/05  1.修正

2016/10/26  1.ランク表示修正

2016/10/26  1.特殊フラグ選択時の府県クリア処理カット

2017/09/05  1.G213の参照条件追加(2017年度の３年生)

2017/09/06  1.修正漏れ。G213の参照条件追加(2017年度の３年生)
            2.補助額セットボタン追加と、処理修正
            2.修正

2017/09/06  1.ボタン名変更。補助額セット → 補助額再計算

2018/09/04  1.テーブル変更に伴う修正(前期と後期で下限上限を分ける)
            -- rep-reduction_mst.sql(rev.62086)

2018/10/06  1.教育課程年度参照はしない(Tフラグでの対応になった為)

2019/09/25  1.兄弟姉妹フィールド追加に伴う修正
            -- rep-reduction_dat.sql(rev.69871)

2019/09/27  1.兄弟姉妹判定時の条件修正
            2.兄弟姉妹判定時の条件修正

2019/10/29  1.所得割が257499より大きい場合のみ、兄弟姉妹を参照する。

2019/10/30  1.都道府県表示機能修正。
            -- 再計算で、所得割１又は２で正常な方の都道府県を表示する。
            -- マスタに存在しないデータは、バックカラーをピンクで表示

2020/10/29  1.2019/10/29の修正をカット。(所得割が257499より大きい場合のみ、兄弟姉妹を参照する。)
